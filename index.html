<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai Homes Residents Welfare Association</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        /* ========================================
           COLOR SCHEME: Nature-Inspired Earthy Tones
           ========================================
           Designed for maximum eye comfort with natural harmony
           
           Primary Colors (Natural & Grounding):
           - Primary Olive: #7a9b76 (Soft olive green - main actions)
           - Dark Olive: #5d7a5a (Deep olive - text & emphasis)
           - Accent Tan: #b8956a (Warm tan - variety)
           - Accent Sage: #a8b5a3 (Soft sage - subtle elements)
           
           Status Badge Colors (Muted Natural Tones):
           - Pending: #f9f4ed bg, #8a7456 text (Soft sand)
           - Initiated: #edf4f7 bg, #5a7a8f text (Soft sky blue)
           - In Progress: #f7ede8 bg, #9d7864 text (Soft clay)
           - Resolved: #edf3ec bg, #5d7a5a text (Soft olive)
           
           Background Colors (Warm & Natural):
           - Form Background: #f7f8f4 (Warm cream)
           - Card Background: #fcfdfc (Off-white)
           - Light Background: #f0f2ee (Light sage)
           - Container: #ffffff (Pure white - minimal)
           
           Neutral Colors (Earthy Tones):
           - Border Light: #eff2f0 (Very light sage)
           - Border Medium: #dfe3da (Soft sage)
           - Border Strong: #c4ccc7 (For emphasis)
           - Text Dark: #3d4a3a (Earthy dark)
           - Text Medium: #6d7869 (Warm gray)
           - Text Light: #9ba594 (Light gray)
           
           DARK MODE PALETTE:
           - Background: #1a1f1d (Deep forest)
           - Card Background: #242928 (Dark sage)
           - Form Background: #2d3532 (Medium dark sage)
           - Text: #e8ebe9 (Soft white)
           - Text Medium: #b8bfbb (Soft gray)
           - Border: #3a4441 (Dark border)
           ======================================== */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        } <!-- This is a comment -->


        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #2d3e3a 0%, #1f2d28 100%);
        }

        .dark-mode .container {
            background: #1a1f1d;
            color: #e8ebe9;
        }

        .dark-mode .header {
            background: linear-gradient(135deg, #3d5249 0%, #2d4239 100%);
        }

        .dark-mode .tabs {
            background: #242928;
            border-bottom: 2px solid #3a4441;
        }

        .dark-mode .tab {
            color: #b8bfbb;
        }

        .dark-mode .tab:hover {
            background: #2d3532;
        }

        .dark-mode .tab.active {
            color: #8fb88a;
            border-bottom-color: #7a9b76;
            background: #1a1f1d;
        }

        .dark-mode .tab-content {
            background: #1f2521;
        }

        .dark-mode label {
            color: #e8ebe9;
        }

        .dark-mode input,
        .dark-mode select,
        .dark-mode textarea {
            background: #2d3532;
            border-color: #3a4441;
            color: #e8ebe9;
        }

        .dark-mode input:focus,
        .dark-mode select:focus,
        .dark-mode textarea:focus {
            border-color: #7a9b76;
            box-shadow: 0 0 0 3px rgba(122, 155, 118, 0.2);
        }

        .dark-mode .complaint-card {
            background: #242928;
            border-left-color: #b8956a;
        }

        .dark-mode .complaint-card:hover {
            background: #2d3532;
        }

        .dark-mode .complaint-id {
            color: #8fb88a;
        }

        .dark-mode .info-label {
            color: #b8bfbb;
        }

        .dark-mode .info-value {
            color: #e8ebe9;
        }

        .dark-mode .complaint-description {
            background: #2d3532;
            color: #e8ebe9;
        }

        .dark-mode .status-badge {
            opacity: 1;
        }

        /* Dark mode status badge colors - darker backgrounds */
        .dark-mode .status-pending {
            background: #5d3a1a;
            color: #ffb74d;
        }

        .dark-mode .status-initiated {
            background: #1e3a5f;
            color: #64b5f6;
        }

        .dark-mode .status-in-progress {
            background: #5d4e1a;
            color: #fff176;
        }

        .dark-mode .status-resolved {
            background: #2d4a2d;
            color: #81c784;
        }

        .dark-mode .btn-small {
            background: #2d3532;
            color: #8fb88a;
            border-color: #7a9b76;
        }

        .dark-mode .btn-small:hover {
            background: #7a9b76;
            color: white;
        }

        /* Additional text visibility fixes */
        .dark-mode h1,
        .dark-mode h2,
        .dark-mode h3,
        .dark-mode h4,
        .dark-mode h5,
        .dark-mode h6 {
            color: #e8ebe9;
        }

        .dark-mode p,
        .dark-mode span,
        .dark-mode div {
            color: inherit;
        }

        .dark-mode .info-value {
            color: #e8ebe9;
        }

        .dark-mode strong {
            color: #e8ebe9;
        }

        .dark-mode .legend-item {
            color: #b8bfbb;
        }

        .dark-mode .stat-label {
            color: white;
        }

        .dark-mode .stat-number {
            color: white;
        }

        .dark-mode .summary-stat-label {
            color: rgba(255, 255, 255, 0.9);
        }

        .dark-mode .summary-stat-number {
            color: white;
        }

        .dark-mode select option {
            background: #2d3532;
            color: #e8ebe9;
        }

        .dark-mode .dashboard-table td {
            color: #e8ebe9;
        }

        .dark-mode .close {
            color: #b8bfbb;
        }

        .dark-mode .close:hover {
            color: #e8ebe9;
        }

        /* Comprehensive text visibility fixes for dark mode */
        .dark-mode .complaint-details {
            color: #e8ebe9;
        }

        .dark-mode .complaint-details .info-label {
            color: #b8bfbb;
        }

        .dark-mode .complaint-details .info-value {
            color: #e8ebe9;
        }

        .dark-mode .complaint-item strong {
            color: #e8ebe9;
        }

        .dark-mode .filter-label {
            color: #e8ebe9;
        }

        .dark-mode .export-btn {
            background: #7a9b76;
            color: white;
        }

        .dark-mode .export-btn:hover {
            background: #6a8a68;
        }

        .dark-mode .summary-card {
            background: #242928;
        }

        .dark-mode .summary-title {
            color: #b8bfbb;
        }

        .dark-mode .category-count {
            color: #e8ebe9;
        }

        .dark-mode th {
            color: white;
        }

        .dark-mode .btn-secondary {
            background: #3a4441;
            color: #e8ebe9;
            border-color: #7a9b76;
        }

        .dark-mode .btn-secondary:hover {
            background: #4d5a54;
        }

        .dark-mode .btn-danger {
            background: #7a4444;
            color: white;
        }

        .dark-mode .btn-danger:hover {
            background: #6a3434;
        }

        .dark-mode code {
            background: #1a1f1d;
            color: #8fb88a;
        }

        .dark-mode pre {
            background: #1a1f1d;
            border-color: #3a4441;
        }

        .dark-mode pre code {
            color: #e8ebe9;
        }

        .dark-mode .note {
            background: #2d3532;
            border-left-color: #b8956a;
            color: #e8ebe9;
        }

        .dark-mode .step-number {
            background: #7a9b76;
            color: white;
        }

        .dark-mode ol li {
            color: #e8ebe9;
        }

        .dark-mode ul li {
            color: #e8ebe9;
        }

        .dark-mode .chart-container {
            color: #e8ebe9;
        }

        .dark-mode .axis-label {
            fill: #b8bfbb;
        }

        .dark-mode .grid-line {
            stroke: #3a4441;
        }

        .dark-mode .complaint-card p {
            color: #e8ebe9;
        }

        .dark-mode .complaint-card strong {
            color: white;
        }

        .dark-mode .description-text {
            color: #e8ebe9;
        }

        .dark-mode .date-text {
            color: #b8bfbb;
        }

        .dark-mode .refresh-btn {
            background: #7a9b76;
            color: white;
        }

        .dark-mode .refresh-btn:hover {
            background: #6a8a68;
        }

        /* Dashboard and Reports titles in dark mode */
        .dark-mode .dashboard-title {
            color: white !important;
        }

        .dark-mode .reports-title {
            color: white !important;
        }

        .dark-mode .dashboard-table-title {
            color: white !important;
        }

        /* Chart text visibility in dark mode */
        .dark-mode .chart-title {
            color: white !important;
        }

        .dark-mode .chart-label {
            color: #e8ebe9;
        }

        .dark-mode .chart-value {
            color: #e8ebe9;
        }

        .dark-mode .legend-label {
            color: #e8ebe9;
        }

        .dark-mode .bar-label {
            fill: #e8ebe9;
        }

        .dark-mode text {
            fill: #e8ebe9 !important;
        }

        .dark-mode tspan {
            fill: #e8ebe9 !important;
        }

        /* Dashboard overview section */
        .dark-mode .dashboard-summary h2 {
            color: white;
        }

        .dark-mode .dashboard-summary h3 {
            color: white;
        }

        /* Admin Panel text visibility */
        .dark-mode .admin-section h3 {
            color: white;
        }

        .dark-mode .admin-section label {
            color: #e8ebe9;
        }

        .dark-mode .admin-section p {
            color: #e8ebe9;
        }

        .dark-mode .form-row label {
            color: #e8ebe9;
        }

        .dark-mode .user-role {
            color: #b8bfbb;
        }

        /* Table status badges in dark mode - match View Complaints status badges */
        .dark-mode .table-status-pending {
            background: #5d3a1a;
            color: #ffb74d;
        }

        .dark-mode .table-status-initiated {
            background: #1e3a5f;
            color: #64b5f6;
        }

        .dark-mode .table-status-in-progress {
            background: #5d4e1a;
            color: #fff176;
        }

        .dark-mode .table-status-resolved {
            background: #2d4a2d;
            color: #81c784;
        }

        /* Admin Panel text styles for light mode */
        .admin-user-management-title {
            color: #3d4a3a;
        }

        .admin-form-title {
            color: #7a9b76;
        }

        .admin-section-title {
            color: #3d4a3a;
        }

        /* Comprehensive Admin Panel dark mode text visibility */
        .dark-mode .admin-user-management-title {
            color: white !important;
        }

        .dark-mode .admin-form-title {
            color: #a8c9a8 !important;
        }

        .dark-mode .admin-section-title {
            color: white !important;
        }

        .dark-mode #adminContent h3 {
            color: white !important;
        }

        .dark-mode #adminContent h4 {
            color: white !important;
        }

        .dark-mode #addUserForm {
            background: #2d3532 !important;
        }

        .dark-mode #addUserForm h4 {
            color: #a8c9a8 !important;
        }

        .dark-mode .modal-header h2 {
            color: white;
        }

        .dark-mode .modal-header p {
            color: #b8bfbb;
        }

        .dark-mode .password-toggle .toggle-password {
            color: #b8bfbb;
        }

        .dark-mode .logout-btn {
            background: #7a4444;
            color: white;
        }

        .dark-mode .logout-btn:hover {
            background: #6a3434;
        }

        .dark-mode #loggedInUser {
            color: #a8c9a8;
        }

        .dark-mode .admin-locked {
            color: white;
        }

        .dark-mode .admin-locked p {
            color: white;
        }

        .dark-mode .admin-locked h3 {
            color: white;
        }

        /* Resolution Details Styles */
        .resolution-details-container {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #0066cc;
        }

        .resolution-details-title {
            color: #003d82;
            font-weight: 600;
        }

        .resolution-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .resolution-detail-label {
            font-size: 0.85em;
            color: #6c757d;
        }

        .resolution-detail-value {
            font-weight: 600;
            color: #333;
        }

        /* Dark mode for Resolution Details */
        .dark-mode .resolution-details-container {
            background: #2d3e47;
            border-left-color: #64b5f6;
        }

        .dark-mode .resolution-details-title {
            color: #90caf9;
        }

        .dark-mode .resolution-detail-label {
            color: #b8bfbb;
        }

        .dark-mode .resolution-detail-value {
            color: white;
        }

        /* Resolution Form Styles */
        .resolution-form-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .resolution-form-title {
            margin-bottom: 15px;
            color: #5d7a5a;
        }

        .dark-mode .resolution-form-container {
            background: #2d3532;
        }

        .dark-mode .resolution-form-title {
            color: #a8c9a8;
        }

        .dark-mode .filter-section {
            background: #242928;
        }

        .dark-mode .empty-state {
            color: #b8bfbb;
        }

        .dark-mode .modal-content {
            background: #242928;
            color: #e8ebe9;
        }

        .dark-mode .user-management {
            background: #242928;
        }

        .dark-mode .user-item {
            background: #2d3532;
        }

        .dark-mode .user-name {
            color: #e8ebe9;
        }

        .dark-mode .user-username {
            color: #b8bfbb;
        }

        .dark-mode .dropdown-header {
            background: #2d3532;
            border-color: #3a4441;
            color: #e8ebe9;
        }

        .dark-mode .dropdown-header:hover,
        .dark-mode .dropdown-header.active {
            border-color: #7a9b76;
        }

        .dark-mode .dropdown-header-text {
            color: #e8ebe9;
        }

        .dark-mode .dropdown-header-text.placeholder {
            color: #b8bfbb;
        }

        .dark-mode .dropdown-list {
            background: #2d3532;
            border-color: #7a9b76;
        }

        .dark-mode .dropdown-item {
            border-bottom-color: #3a4441;
        }

        .dark-mode .dropdown-item:hover {
            background: #3a4441;
        }

        .dark-mode .dropdown-item.selected {
            background: #3d5249;
            color: #8fb88a;
        }

        .dark-mode .chart-card {
            background: #242928;
        }

        .dark-mode .chart-title {
            color: #e8ebe9;
        }

        .dark-mode .chart-legend {
            border-top-color: #3a4441;
        }

        .dark-mode .dashboard-table-container {
            background: #242928;
        }

        .dark-mode .dashboard-table {
            color: #e8ebe9;
        }

        .dark-mode .dashboard-table tbody tr {
            border-bottom-color: #3a4441;
        }

        .dark-mode .dashboard-table tbody tr:hover {
            background: #2d3532;
        }

        .dark-mode .setup-section {
            background: #3a4441;
        }

        .dark-mode .setup-section h3 {
            color: #c9a876;
        }

        .dark-mode .setup-section code {
            background: #2d3532;
            color: #8fb88a;
        }

        .dark-mode .success-message {
            background: #2d3e36;
            color: #8fb88a;
            border-left-color: #7a9b76;
        }

        .dark-mode .error-message {
            background: #3e2d2d;
            color: #d89b9b;
            border-left-color: #a86767;
        }

        .dark-mode .info-message {
            background: #2d3537;
            color: #8fa9b8;
            border-left-color: #7a9b9f;
        }

        /* Dark Mode Toggle Button */
        .dark-mode-toggle {
            position: absolute;
            top: 35px;
            left: 30px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
            backdrop-filter: blur(10px);
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            background: rgba(255, 255, 255, 0.3);
        }

        .dark-mode-toggle:active {
            transform: scale(0.95);
        }

        .dark-mode-icon {
            font-size: 24px;
            transition: transform 0.5s;
        }

        .dark-mode .dark-mode-toggle {
            background: rgba(184, 149, 106, 0.3);
            border-color: rgba(184, 149, 106, 0.4);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .dark-mode .dark-mode-toggle:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            background: rgba(184, 149, 106, 0.4);
        }

        .dark-mode .dark-mode-icon {
            transform: rotate(180deg);
        }

        /* Make header position relative for absolute positioning */
        .header {
            position: relative;
        }

        /* Smooth transitions for dark mode */
        body,
        .container,
        .header,
        .tabs,
        .tab,
        .tab-content,
        label,
        input,
        select,
        textarea,
        .complaint-card,
        .filter-section,
        .modal-content,
        .user-management,
        .user-item,
        .dropdown-header,
        .dropdown-list,
        .dropdown-item,
        .chart-card,
        .dashboard-table-container,
        .setup-section {
            transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Mobile responsive for toggle button */
        @media (max-width: 768px) {
            .dark-mode-toggle {
                top: 20px;
                left: 15px;
                width: 45px;
                height: 45px;
            }
            
            .dark-mode-icon {
                font-size: 20px;
            }
            
            .header h1 {
                font-size: 1.5em;
                padding-left: 60px; /* Make room for toggle on left */
            }
        }


        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #7a9b76 0%, #6a8a68 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #5d7a5a 0%, #4d6a4d 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            background: #fcfdfc;
            border-bottom: 2px solid #dfe3da;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #6d7869;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 1em;
        }

        .tab:hover {
            background: #f0f2ee;
        }

        .tab.active {
            color: #5d7a5a;
            border-bottom: 3px solid #7a9b76;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            background: #f7f8f4;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #3d4a3a;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dfe3da;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
            background: white;
        }

        input[type="date"] {
            cursor: pointer;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            padding: 5px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #7a9b76;
            box-shadow: 0 0 0 3px rgba(122, 155, 118, 0.15);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: linear-gradient(135deg, #7a9b76 0%, #6a8a68 100%);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(122, 155, 118, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .complaint-card {
            background: #fcfdfc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #b8956a;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .complaint-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .complaint-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .complaint-id {
            font-weight: 700;
            color: #5d7a5a;
            font-size: 1.1em;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff4e6;
            color: #e67e22;
        }

        .status-initiated {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-in-progress {
            background: #fff9c4;
            color: #f9a825;
        }

        .status-resolved {
            background: #e8f5e9;
            color: #388e3c;
        }

        .complaint-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.85em;
            color: #6d7869;
            margin-bottom: 4px;
        }

        .info-value {
            font-weight: 600;
            color: #3d4a3a;
        }

        .complaint-description {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            line-height: 1.6;
        }

        .filter-section {
            background: #fcfdfc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #b8956a 0%, #a88560 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            background: white;
            color: #7a9b76;
            border: 2px solid #7a9b76;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-small:hover {
            background: #7a9b76;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6d7869;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 40px;
            border-radius: 15px;
            max-width: 450px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            color: #7a9b76;
            margin-bottom: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        .close:hover {
            color: #000;
        }

        .login-form {
            margin-top: 20px;
        }

        .user-management {
            background: #fcfdfc;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .user-list {
            margin-top: 20px;
        }

        .user-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .user-username {
            font-size: 0.9em;
            color: #6d7869;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .admin-locked {
            text-align: center;
            padding: 60px 20px;
            color: #6d7869;
        }

        .admin-locked svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .password-toggle {
            position: relative;
        }

        .password-toggle input {
            padding-right: 45px;
        }

        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6d7869;
            user-select: none;
        }

        .toggle-password:hover {
            color: #3d4a3a;
        }

        .success-message, .error-message, .info-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid;
            display: none;
        }

        .success-message {
            background: #d1e7dd;
            color: #0f5132;
            border-left-color: #0f5132;
        }

        .error-message {
            background: #f8d7da;
            color: #842029;
            border-left-color: #842029;
        }

        .info-message {
            background: #f0f4ed;
            color: #5d7a5a;
            border-left-color: #7a9b76;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .setup-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
            margin-bottom: 25px;
        }

        .setup-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .setup-section ol {
            margin-left: 20px;
            line-height: 1.8;
        }

        .setup-section code {
            background: #fcfdfc;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #7a9b76;
        }

        /* Custom Multi-Select Dropdown Styles */
        .custom-dropdown {
            position: relative;
            width: 100%;
        }

        .dropdown-header {
            width: 100%;
            padding: 12px;
            border: 2px solid #dfe3da;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.3s;
            min-height: 48px;
        }

        .dropdown-header:hover,
        .dropdown-header.active {
            border-color: #7a9b76;
        }

        .dropdown-header-text {
            flex: 1;
            color: #3d4a3a;
        }

        .dropdown-header-text.placeholder {
            color: #6d7869;
        }

        .dropdown-arrow {
            margin-left: 10px;
            transition: transform 0.3s;
        }

        .dropdown-header.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #7a9b76;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .dropdown-list.active {
            display: block;
        }

        .dropdown-item {
            padding: 12px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f0f2ee;
        }

        .dropdown-item.selected {
            background: #edf3ec;
            font-weight: 600;
            color: #5d7a5a;
        }

        .dropdown-item-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #b8956a;
            border-radius: 4px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .dropdown-item.selected .dropdown-item-checkbox {
            background: #b8956a;
        }

        .dropdown-item.selected .dropdown-item-checkbox::after {
            content: '‚úì';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .selected-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .selected-tag {
            background: #7a9b76;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .selected-tag-remove {
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            line-height: 1;
        }

        .selected-tag-remove:hover {
            color: #ffcccc;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .chart-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .chart-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #3d4a3a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #7a9b76;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 15px;
        }

        .chart-canvas {
            max-height: 300px;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dfe3da;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .dashboard-summary {
            background: linear-gradient(135deg, #7a9b76 0%, #6a8a68 100%);
            color: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(122, 155, 118, 0.25);
        }

        .dashboard-summary h2 {
            margin: 0 0 20px 0;
            font-size: 1.5em;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .summary-stat {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .summary-stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Dashboard Table Styles */
        .dashboard-table-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-top: 30px;
            overflow-x: auto;
        }

        .dashboard-table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #b8956a;
        }

        .dashboard-table-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #3d4a3a;
        }

        .dashboard-title {
            color: #3d4a3a;
        }

        .reports-title {
            color: #3d4a3a;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
        }

        .export-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .export-btn.csv {
            background: #28a745;
            color: white;
        }

        .export-btn.csv:hover {
            background: #218838;
        }

        .dashboard-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .dashboard-table thead {
            background: linear-gradient(135deg, #5d7a5a 0%, #4d6a4d 100%);
            color: white;
        }

        .dashboard-table th {
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .dashboard-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .dashboard-table tbody tr:hover {
            background: #f8f9fa;
        }

        .dashboard-table tbody tr:last-child td {
            border-bottom: none;
        }

        .table-status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            white-space: nowrap;
            display: inline-block;
        }

        .table-status-pending {
            background: #fff4e6;
            color: #e67e22;
        }

        .table-status-initiated {
            background: #e3f2fd;
            color: #1976d2;
        }

        .table-status-in-progress {
            background: #fff9c4;
            color: #f9a825;
        }

        .table-status-resolved {
            background: #e8f5e9;
            color: #388e3c;
        }

        .table-priority-low {
            color: #28a745;
            font-weight: 600;
        }

        .table-priority-medium {
            color: #ffc107;
            font-weight: 600;
        }

        .table-priority-high {
            color: #fd7e14;
            font-weight: 600;
        }

        .table-priority-urgent {
            color: #dc3545;
            font-weight: 600;
        }

        .table-empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                padding: 15px;
            }

            .tab-content {
                padding: 20px;
            }

            .complaint-header {
                flex-direction: column;
            }

            .stat-number {
                font-size: 2em;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 250px;
            }

            .dashboard-table {
                font-size: 0.8em;
            }

            .dashboard-table th,
            .dashboard-table td {
                padding: 8px 6px;
            }

            .export-buttons {
                flex-direction: column;
            }

            .dashboard-table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Thai Homes Residents Welfare Association</h1>
            <!-- Dark Mode Toggle Button -->
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode" title="Toggle Dark Mode">
                <span class="dark-mode-icon">‚òÄÔ∏è</span>
            </button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('register', event)">üìù Register Complaint</button>
            <button class="tab" onclick="switchTab('view', event)">üìã View Complaints</button>
            <button class="tab" onclick="switchTab('dashboard', event)">üìä Dashboard</button>
            <button class="tab" onclick="switchTab('reports', event)">üìë Reports</button>
            <button class="tab" onclick="switchTab('admin', event)">‚öôÔ∏è Admin Panel</button>
        </div>

        <!-- Register Complaint Tab -->
        <div id="register" class="tab-content active">
            <div class="success-message" id="successMessage">
                ‚úì Complaint registered successfully! Your complaint ID is <strong id="complaintIdDisplay"></strong>
            </div>
            <div class="error-message" id="errorMessage"></div>

            <form id="complaintForm">
                <div class="form-group">
                    <label for="blockName">Block *</label>
                    <select id="blockName" required disabled>
                        <option value="">Auto-selected based on flat</option>
                        <option value="Block A">Block A</option>
                        <option value="Block B">Block B</option>
                        <option value="THRWA">THRWA</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="flatNumber">Flat Number *</label>
                    <select id="flatNumber" required onchange="updateBlock()">
                        <option value="">Select your flat number</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="residentName">Resident Name *</label>
                    <input type="text" id="residentName" placeholder="Enter your name" required>
                </div>

                <div class="form-group">
                    <label for="contactNumber">Contact Number</label>
                    <input type="tel" id="contactNumber" placeholder="Enter your mobile number (optional)" pattern="[0-9]{10}">
                </div>

                <div class="form-group">
                    <label for="category">
                        Complaint Category * 
                        <span id="categoryError" style="color: #dc3545; font-weight: bold; margin-left: 10px; display: none;">please choose a valid option</span>
                    </label>
                    <div class="custom-dropdown" id="categoryDropdown">
                        <div class="dropdown-header" onclick="toggleCategoryDropdown()">
                            <span class="dropdown-header-text placeholder" id="categoryHeaderText">Select category</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="dropdown-list" id="categoryList">
                            <div class="dropdown-item" data-value="Access Card Reader" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Access Card Reader</span>
                            </div>
                            <div class="dropdown-item" data-value="Access Door" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Access Door</span>
                            </div>
                            <div class="dropdown-item" data-value="Builder" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Builder</span>
                            </div>
                            <div class="dropdown-item" data-value="CCTV Camera" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>CCTV Camera</span>
                            </div>
                            <div class="dropdown-item" data-value="CCTV Monitor" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>CCTV Monitor</span>
                            </div>
                            <div class="dropdown-item" data-value="Cleaning" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Cleaning/Housekeeping</span>
                            </div>
                            <div class="dropdown-item" data-value="Common Area" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Common Area</span>
                            </div>
                            <div class="dropdown-item" data-value="Drainage" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Drainage</span>
                            </div>
                            <div class="dropdown-item" data-value="Electrical" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Electrical</span>
                            </div>
                            <div class="dropdown-item" data-value="Gates" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Gates</span>
                            </div>
                            <div class="dropdown-item" data-value="Genset" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Genset</span>
                            </div>
                            <div class="dropdown-item" data-value="Lift" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Lift/Elevator</span>
                            </div>
                            <div class="dropdown-item" data-value="Noise" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Noise Complaint</span>
                            </div>
                            <div class="dropdown-item" data-value="Overhead tank" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Overhead tank</span>
                            </div>
                            <div class="dropdown-item" data-value="Paints" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Paints</span>
                            </div>
                            <div class="dropdown-item" data-value="Parking" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Parking</span>
                            </div>
                            <div class="dropdown-item" data-value="Plumbing" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Plumbing</span>
                            </div>
                            <div class="dropdown-item" data-value="Seepages" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Seepages</span>
                            </div>
                            <div class="dropdown-item" data-value="Security" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Security</span>
                            </div>
                            <div class="dropdown-item" data-value="Solar Panels" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Solar Panels</span>
                            </div>
                            <div class="dropdown-item" data-value="Structural" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Structural</span>
                            </div>
                            <div class="dropdown-item" data-value="Sump" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Sump</span>
                            </div>
                            <div class="dropdown-item" data-value="Water Supply" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Water Supply</span>
                            </div>
                            <div class="dropdown-item" data-value="Other" onclick="selectCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Other</span>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="category" required>
                    <div class="selected-tags" id="selectedCategoryTags"></div>
                </div>

                <div class="form-group">
                    <label for="priority">Priority Level *</label>
                    <select id="priority" required>
                        <option value="">Select priority</option>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                        <option value="Urgent">Urgent</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="description">Complaint Description *</label>
                    <textarea id="description" placeholder="Please describe your complaint in detail..." required></textarea>
                </div>

                <button type="submit" class="btn" id="submitBtn">Submit Complaint</button>
            </form>
        </div>

        <!-- View Complaints Tab -->
        <div id="view" class="tab-content">
            <div class="info-message" id="viewInfoMessage"></div>
            
            <div class="filter-section">
                <div class="form-group">
                    <label for="filterStatus">Filter by Status</label>
                    <select id="filterStatus" onchange="filterComplaints()">
                        <option value="">All Statuses</option>
                        <option value="Pending">Pending</option>
                        <option value="Initiated">Initiated</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="filterCategory">Filter by Category</label>
                    <div class="custom-dropdown" id="filterCategoryDropdown">
                        <div class="dropdown-header" onclick="toggleFilterCategoryDropdown()">
                            <span class="dropdown-header-text" id="filterCategoryHeaderText">All Categories</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="dropdown-list" id="filterCategoryList">
                            <div class="dropdown-item" data-value="Access Card Reader" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Access Card Reader</span>
                            </div>
                            <div class="dropdown-item" data-value="Access Door" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Access Door</span>
                            </div>
                            <div class="dropdown-item" data-value="Builder" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Builder</span>
                            </div>
                            <div class="dropdown-item" data-value="CCTV Camera" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>CCTV Camera</span>
                            </div>
                            <div class="dropdown-item" data-value="CCTV Monitor" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>CCTV Monitor</span>
                            </div>
                            <div class="dropdown-item" data-value="Cleaning" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Cleaning/Housekeeping</span>
                            </div>
                            <div class="dropdown-item" data-value="Common Area" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Common Area</span>
                            </div>
                            <div class="dropdown-item" data-value="Drainage" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Drainage</span>
                            </div>
                            <div class="dropdown-item" data-value="Electrical" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Electrical</span>
                            </div>
                            <div class="dropdown-item" data-value="Gates" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Gates</span>
                            </div>
                            <div class="dropdown-item" data-value="Genset" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Genset</span>
                            </div>
                            <div class="dropdown-item" data-value="Lift" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Lift/Elevator</span>
                            </div>
                            <div class="dropdown-item" data-value="Noise" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Noise Complaint</span>
                            </div>
                            <div class="dropdown-item" data-value="Overhead tank" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Overhead tank</span>
                            </div>
                            <div class="dropdown-item" data-value="Paints" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Paints</span>
                            </div>
                            <div class="dropdown-item" data-value="Parking" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Parking</span>
                            </div>
                            <div class="dropdown-item" data-value="Plumbing" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Plumbing</span>
                            </div>
                            <div class="dropdown-item" data-value="Seepages" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Seepages</span>
                            </div>
                            <div class="dropdown-item" data-value="Security" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Security</span>
                            </div>
                            <div class="dropdown-item" data-value="Solar Panels" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Solar Panels</span>
                            </div>
                            <div class="dropdown-item" data-value="Structural" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Structural</span>
                            </div>
                            <div class="dropdown-item" data-value="Sump" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Sump</span>
                            </div>
                            <div class="dropdown-item" data-value="Water Supply" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Water Supply</span>
                            </div>
                            <div class="dropdown-item" data-value="Other" onclick="selectFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Other</span>
                            </div>
                        </div>
                    </div>
                    <div class="selected-tags" id="filterCategoryTags" style="margin-top: 8px;"></div>
                </div>

                <div class="form-group">
                    <label for="filterBlock">Filter by Block</label>
                    <select id="filterBlock" onchange="filterComplaints()">
                        <option value="">All Blocks</option>
                        <option value="Block A">Block A</option>
                        <option value="Block B">Block B</option>
                        <option value="THRWA">THRWA</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="filterFlat">Filter by Flat</label>
                    <select id="filterFlat" onchange="filterComplaints()">
                        <option value="">All Flats</option>
                    </select>
                </div>

                <div class="form-group">
                    <button class="btn" onclick="loadComplaints()" style="margin-top: 25px;">
                        üîÑ Refresh Complaints
                    </button>
                </div>
            </div>

            <div id="complaintsContainer"></div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <h2 class="dashboard-title" style="margin-bottom: 20px;">üìä Complaints Dashboard</h2>

            <!-- Dashboard Summary -->
            <div class="dashboard-summary">
                <h2>Overview</h2>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="dashTotalComplaints">0</div>
                        <div class="summary-stat-label">Total Complaints</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="dashPendingComplaints">0</div>
                        <div class="summary-stat-label">Pending</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="dashInitiatedComplaints">0</div>
                        <div class="summary-stat-label">Initiated</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="dashInProgressComplaints">0</div>
                        <div class="summary-stat-label">In Progress</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="dashResolvedComplaints">0</div>
                        <div class="summary-stat-label">Resolved</div>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="filter-section" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label for="dashFilterStatus">Filter by Status</label>
                    <select id="dashFilterStatus" onchange="updateDashboard()">
                        <option value="">All Statuses</option>
                        <option value="Pending">Pending</option>
                        <option value="Initiated">Initiated</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="dashFilterCategory">Filter by Category</label>
                    <div class="custom-dropdown" id="dashFilterCategoryDropdown">
                        <div class="dropdown-header" onclick="toggleDashFilterCategoryDropdown()">
                            <span class="dropdown-header-text" id="dashFilterCategoryHeaderText">All Categories</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="dropdown-list" id="dashFilterCategoryList">
                            <div class="dropdown-item" data-value="Access Card Reader" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Access Card Reader</span>
                            </div>
                            <div class="dropdown-item" data-value="Access Door" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Access Door</span>
                            </div>
                            <div class="dropdown-item" data-value="Builder" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Builder</span>
                            </div>
                            <div class="dropdown-item" data-value="CCTV Camera" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>CCTV Camera</span>
                            </div>
                            <div class="dropdown-item" data-value="CCTV Monitor" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>CCTV Monitor</span>
                            </div>
                            <div class="dropdown-item" data-value="Cleaning" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Cleaning/Housekeeping</span>
                            </div>
                            <div class="dropdown-item" data-value="Common Area" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Common Area</span>
                            </div>
                            <div class="dropdown-item" data-value="Drainage" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Drainage</span>
                            </div>
                            <div class="dropdown-item" data-value="Electrical" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Electrical</span>
                            </div>
                            <div class="dropdown-item" data-value="Gates" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Gates</span>
                            </div>
                            <div class="dropdown-item" data-value="Genset" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Genset</span>
                            </div>
                            <div class="dropdown-item" data-value="Lift" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Lift/Elevator</span>
                            </div>
                            <div class="dropdown-item" data-value="Noise" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Noise Complaint</span>
                            </div>
                            <div class="dropdown-item" data-value="Overhead tank" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Overhead tank</span>
                            </div>
                            <div class="dropdown-item" data-value="Paints" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Paints</span>
                            </div>
                            <div class="dropdown-item" data-value="Parking" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Parking</span>
                            </div>
                            <div class="dropdown-item" data-value="Plumbing" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Plumbing</span>
                            </div>
                            <div class="dropdown-item" data-value="Seepages" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Seepages</span>
                            </div>
                            <div class="dropdown-item" data-value="Security" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Security</span>
                            </div>
                            <div class="dropdown-item" data-value="Solar Panels" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Solar Panels</span>
                            </div>
                            <div class="dropdown-item" data-value="Structural" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Structural</span>
                            </div>
                            <div class="dropdown-item" data-value="Sump" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Sump</span>
                            </div>
                            <div class="dropdown-item" data-value="Water Supply" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Water Supply</span>
                            </div>
                            <div class="dropdown-item" data-value="Other" onclick="selectDashFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Other</span>
                            </div>
                        </div>
                    </div>
                    <div class="selected-tags" id="dashFilterCategoryTags" style="margin-top: 8px;"></div>
                </div>

                <div class="form-group">
                    <label for="dashFilterBlock">Filter by Block</label>
                    <select id="dashFilterBlock" onchange="updateDashboard()">
                        <option value="">All Blocks</option>
                        <option value="Block A">Block A</option>
                        <option value="Block B">Block B</option>
                        <option value="THRWA">THRWA</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="dashFilterFlat">Filter by Flat</label>
                    <select id="dashFilterFlat" onchange="updateDashboard()">
                        <option value="">All Flats</option>
                    </select>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="dashboard-grid">
                <!-- Status Distribution Chart -->
                <div class="chart-card">
                    <div class="chart-title">üìä Status Distribution</div>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>

                <!-- Category Distribution Chart -->
                <div class="chart-card">
                    <div class="chart-title">üè∑Ô∏è Top Categories</div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- Block Distribution Chart -->
                <div class="chart-card">
                    <div class="chart-title">üè¢ Complaints by Block</div>
                    <div class="chart-container">
                        <canvas id="blockChart"></canvas>
                    </div>
                </div>

                <!-- Priority Distribution Chart -->
                <div class="chart-card">
                    <div class="chart-title">‚ö° Priority Levels</div>
                    <div class="chart-container">
                        <canvas id="priorityChart"></canvas>
                    </div>
                </div>

                <!-- Trend Chart -->
                <div class="chart-card" style="grid-column: span 2;">
                    <div class="chart-title">üìà Complaints Trend (Last 30 Days)</div>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>

            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2 class="reports-title" style="margin-bottom: 20px;">üìë Complaints Reports</h2>

            <!-- Summary Statistics -->
            <div class="dashboard-summary">
                <h2>Report Summary</h2>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="reportsTotalComplaints">0</div>
                        <div class="summary-stat-label">Total Complaints</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="reportsPendingComplaints">0</div>
                        <div class="summary-stat-label">Pending</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="reportsInitiatedComplaints">0</div>
                        <div class="summary-stat-label">Initiated</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="reportsInProgressComplaints">0</div>
                        <div class="summary-stat-label">In Progress</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number" id="reportsResolvedComplaints">0</div>
                        <div class="summary-stat-label">Resolved</div>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="filter-section" style="margin-bottom: 30px;">
                <div class="form-group">
                    <label for="reportsFilterStatus">Filter by Status</label>
                    <select id="reportsFilterStatus" onchange="updateReportsTable()">
                        <option value="">All Statuses</option>
                        <option value="Pending">Pending</option>
                        <option value="Initiated">Initiated</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="reportsFilterCategory">Filter by Category</label>
                    <div class="custom-dropdown" id="reportsFilterCategoryDropdown">
                        <div class="dropdown-header" onclick="toggleReportsFilterCategoryDropdown()">
                            <span class="dropdown-header-text" id="reportsFilterCategoryHeaderText">All Categories</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </div>
                        <div class="dropdown-list" id="reportsFilterCategoryList">
                            <div class="dropdown-item" data-value="Access Card Reader" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Access Card Reader</span>
                            </div>
                            <div class="dropdown-item" data-value="Access Door" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Access Door</span>
                            </div>
                            <div class="dropdown-item" data-value="Builder" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Builder</span>
                            </div>
                            <div class="dropdown-item" data-value="CCTV Camera" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>CCTV Camera</span>
                            </div>
                            <div class="dropdown-item" data-value="CCTV Monitor" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>CCTV Monitor</span>
                            </div>
                            <div class="dropdown-item" data-value="Cleaning" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Cleaning/Housekeeping</span>
                            </div>
                            <div class="dropdown-item" data-value="Common Area" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Common Area</span>
                            </div>
                            <div class="dropdown-item" data-value="Drainage" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Drainage</span>
                            </div>
                            <div class="dropdown-item" data-value="Electrical" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Electrical</span>
                            </div>
                            <div class="dropdown-item" data-value="Gates" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Gates</span>
                            </div>
                            <div class="dropdown-item" data-value="Genset" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Genset</span>
                            </div>
                            <div class="dropdown-item" data-value="Lift" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Lift/Elevator</span>
                            </div>
                            <div class="dropdown-item" data-value="Noise" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Noise Complaint</span>
                            </div>
                            <div class="dropdown-item" data-value="Overhead tank" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Overhead tank</span>
                            </div>
                            <div class="dropdown-item" data-value="Paints" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Paints</span>
                            </div>
                            <div class="dropdown-item" data-value="Parking" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Parking</span>
                            </div>
                            <div class="dropdown-item" data-value="Plumbing" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Plumbing</span>
                            </div>
                            <div class="dropdown-item" data-value="Seepages" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Seepages</span>
                            </div>
                            <div class="dropdown-item" data-value="Security" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Security</span>
                            </div>
                            <div class="dropdown-item" data-value="Solar Panels" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Solar Panels</span>
                            </div>
                            <div class="dropdown-item" data-value="Structural" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Structural</span>
                            </div>
                            <div class="dropdown-item" data-value="Sump" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Sump</span>
                            </div>
                            <div class="dropdown-item" data-value="Water Supply" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Water Supply</span>
                            </div>
                            <div class="dropdown-item" data-value="Other" onclick="selectReportsFilterCategory(this)">
                                <div class="dropdown-item-checkbox"></div>
                                <span>Other</span>
                            </div>
                        </div>
                    </div>
                    <div class="selected-tags" id="reportsFilterCategoryTags" style="margin-top: 8px;"></div>
                </div>

                <div class="form-group">
                    <label for="reportsFilterBlock">Filter by Block</label>
                    <select id="reportsFilterBlock" onchange="updateReportsTable()">
                        <option value="">All Blocks</option>
                        <option value="Block A">Block A</option>
                        <option value="Block B">Block B</option>
                        <option value="THRWA">THRWA</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="reportsFilterFlat">Filter by Flat</label>
                    <select id="reportsFilterFlat" onchange="updateReportsTable()">
                        <option value="">All Flats</option>
                    </select>
                </div>
            </div>

            <!-- Table View -->
            <div class="dashboard-table-container">
                <div class="dashboard-table-header">
                    <div class="dashboard-table-title">üìã Detailed Complaints Table</div>
                    <div class="export-buttons">
                        <button class="export-btn csv" onclick="exportReportsTableToCSV()">üì• Export to CSV</button>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table class="dashboard-table" id="reportsTable">
                        <thead>
                            <tr>
                                <th>Complaint ID</th>
                                <th>Date Registered</th>
                                <th>Block</th>
                                <th>Flat Number</th>
                                <th>Resident Name</th>
                                <th>Contact Number</th>
                                <th>Category</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Description</th>
                                <th>Issue Resolved Date</th>
                                <th>Resolved By</th>
                                <th>Supervisor</th>
                                <th>Last Updated</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <tr>
                                <td colspan="14" class="table-empty-state">No complaints to display</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Admin Panel Tab -->
        <div id="admin" class="tab-content">
            <!-- Login Modal -->
            <div id="loginModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>üîê Admin Login</h2>
                        <p>Executive Committee Members Only</p>
                    </div>
                    <form id="loginForm" class="login-form">
                        <div class="form-group">
                            <label for="loginUsername">Username</label>
                            <input type="text" id="loginUsername" placeholder="Enter your username" required>
                        </div>
                        <div class="form-group password-toggle">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                            <span class="toggle-password" onclick="togglePasswordVisibility('loginPassword')">üëÅÔ∏è</span>
                        </div>
                        <div class="error-message" id="loginError"></div>
                        <button type="submit" class="btn">Login</button>
                    </form>
                </div>
            </div>

            <!-- Admin Content (Hidden until logged in) -->
            <div id="adminContent" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Welcome, <span id="loggedInUser"></span>!</h3>
                    <button class="logout-btn" onclick="logout()">üö™ Logout</button>
                </div>

                <!-- User Management Section -->
                <div class="user-management">
                    <h3 class="admin-user-management-title" style="margin-bottom: 20px;">üë• User Management</h3>
                    
                    <form id="addUserForm" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 class="admin-form-title" style="margin-bottom: 15px;">Add New Executive Member</h4>
                        <div class="form-group">
                            <label for="newUserName">Full Name *</label>
                            <input type="text" id="newUserName" placeholder="e.g., John Doe" required>
                        </div>
                        <div class="form-group">
                            <label for="newUsername">Username *</label>
                            <input type="text" id="newUsername" placeholder="e.g., john.doe" required>
                        </div>
                        <div class="form-group password-toggle">
                            <label for="newPassword">Password *</label>
                            <input type="password" id="newPassword" placeholder="Enter password" required>
                            <span class="toggle-password" onclick="togglePasswordVisibility('newPassword')">üëÅÔ∏è</span>
                        </div>
                        <button type="submit" class="btn">‚ûï Add User</button>
                    </form>

                    <h4 class="admin-section-title" style="margin-bottom: 15px;">Current Executive Members</h4>
                    <div class="user-list" id="userList"></div>
                </div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalComplaints">0</div>
                        <div class="stat-label">Total Complaints</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingComplaints">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="initiatedComplaints">0</div>
                        <div class="stat-label">Initiated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="inProgressComplaints">0</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="resolvedComplaints">0</div>
                        <div class="stat-label">Resolved</div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="loadComplaints()">üîÑ Refresh Data</button>
                </div>

                <!-- Filter Section -->
                <div class="filter-section" style="margin-bottom: 30px;">
                    <div class="form-group">
                        <label for="adminFilterStatus">Filter by Status</label>
                        <select id="adminFilterStatus" onchange="filterAdminComplaints()">
                            <option value="">All Statuses</option>
                            <option value="Pending">Pending</option>
                            <option value="Initiated">Initiated</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Resolved">Resolved</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="adminFilterCategory">Filter by Category</label>
                        <div class="custom-dropdown" id="adminFilterCategoryDropdown">
                            <div class="dropdown-header" onclick="toggleAdminFilterCategoryDropdown()">
                                <span class="dropdown-header-text" id="adminFilterCategoryHeaderText">All Categories</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="dropdown-list" id="adminFilterCategoryList">
                                <div class="dropdown-item" data-value="Access Card Reader" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Access Card Reader</span>
                                </div>
                                <div class="dropdown-item" data-value="Access Door" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Access Door</span>
                                </div>
                                <div class="dropdown-item" data-value="Builder" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Builder</span>
                                </div>
                                <div class="dropdown-item" data-value="CCTV Camera" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>CCTV Camera</span>
                                </div>
                                <div class="dropdown-item" data-value="CCTV Monitor" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>CCTV Monitor</span>
                                </div>
                                <div class="dropdown-item" data-value="Cleaning" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Cleaning/Housekeeping</span>
                                </div>
                                <div class="dropdown-item" data-value="Common Area" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Common Area</span>
                                </div>
                                <div class="dropdown-item" data-value="Drainage" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Drainage</span>
                                </div>
                                <div class="dropdown-item" data-value="Electrical" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Electrical</span>
                                </div>
                                <div class="dropdown-item" data-value="Gates" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Gates</span>
                                </div>
                                <div class="dropdown-item" data-value="Genset" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Genset</span>
                                </div>
                                <div class="dropdown-item" data-value="Lift" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Lift/Elevator</span>
                                </div>
                                <div class="dropdown-item" data-value="Noise" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Noise Complaint</span>
                                </div>
                                <div class="dropdown-item" data-value="Overhead tank" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Overhead tank</span>
                                </div>
                                <div class="dropdown-item" data-value="Paints" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Paints</span>
                                </div>
                                <div class="dropdown-item" data-value="Parking" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Parking</span>
                                </div>
                                <div class="dropdown-item" data-value="Plumbing" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Plumbing</span>
                                </div>
                                <div class="dropdown-item" data-value="Seepages" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Seepages</span>
                                </div>
                                <div class="dropdown-item" data-value="Security" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Security</span>
                                </div>
                                <div class="dropdown-item" data-value="Solar Panels" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Solar Panels</span>
                                </div>
                                <div class="dropdown-item" data-value="Structural" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Structural</span>
                                </div>
                                <div class="dropdown-item" data-value="Sump" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Sump</span>
                                </div>
                                <div class="dropdown-item" data-value="Water Supply" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Water Supply</span>
                                </div>
                                <div class="dropdown-item" data-value="Other" onclick="selectAdminFilterCategory(this)">
                                    <div class="dropdown-item-checkbox"></div>
                                    <span>Other</span>
                                </div>
                            </div>
                        </div>
                        <div class="selected-tags" id="adminFilterCategoryTags" style="margin-top: 8px;"></div>
                    </div>

                    <div class="form-group">
                        <label for="adminFilterBlock">Filter by Block</label>
                        <select id="adminFilterBlock" onchange="filterAdminComplaints()">
                            <option value="">All Blocks</option>
                            <option value="Block A">Block A</option>
                            <option value="Block B">Block B</option>
                            <option value="THRWA">THRWA</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="adminFilterFlat">Filter by Flat</label>
                        <select id="adminFilterFlat" onchange="filterAdminComplaints()">
                            <option value="">All Flats</option>
                        </select>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; color: #333;">Manage All Complaints</h3>
                <div id="adminComplaintsContainer"></div>
            </div>

            <!-- Locked State (Shown when not logged in) -->
            <div id="adminLocked" class="admin-locked">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <h3>Admin Panel Locked</h3>
                <p>This section is restricted to Executive Committee members only.</p>
                <button class="btn" style="margin-top: 20px; max-width: 300px; margin-left: auto; margin-right: auto;" onclick="showLoginModal()">üîê Admin Login</button>
            </div>
        </div>

    </div>

    <script>
        // ============================================
        // TAB NAVIGATION (Must be defined first!)
        // ============================================
        
        // Switch tabs
        function switchTab(tabName, evt) {
            console.log('switchTab called with:', tabName);
            
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            console.log('Found tab contents:', tabContents.length);
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }

            // Remove active class from all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }

            // Show the selected tab content
            const selectedTab = document.getElementById(tabName);
            console.log('Selected tab element:', selectedTab);
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('Added active class to:', tabName);
            } else {
                console.error('Tab not found:', tabName);
            }

            // Add active class to clicked tab button
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add('active');
            }

            // Execute tab-specific actions
            if (tabName === 'view') {
                console.log('Loading complaints...');
                if (typeof loadComplaints === 'function') {
                    loadComplaints();
                }
            } else if (tabName === 'dashboard') {
                console.log('Loading dashboard...');
                if (allComplaints && allComplaints.length > 0) {
                    // Data already loaded, just initialize dashboard
                    if (typeof initializeDashboard === 'function') {
                        initializeDashboard();
                    }
                } else {
                    // Need to load data first
                    if (typeof loadComplaints === 'function') {
                        loadComplaints().then(() => {
                            if (typeof initializeDashboard === 'function') {
                                initializeDashboard();
                            }
                        });
                    }
                }
            } else if (tabName === 'reports') {
                console.log('Loading reports...');
                if (allComplaints && allComplaints.length > 0) {
                    // Data already loaded, just initialize reports
                    if (typeof initializeReportsTable === 'function') {
                        initializeReportsTable();
                    }
                } else {
                    // Need to load data first
                    if (typeof loadComplaints === 'function') {
                        loadComplaints().then(() => {
                            if (typeof initializeReportsTable === 'function') {
                                initializeReportsTable();
                            }
                        });
                    }
                }
            } else if (tabName === 'admin') {
                console.log('Checking admin access...');
                if (typeof checkAdminAccess === 'function') {
                    checkAdminAccess();
                }
            }
        }
        
        // ============================================
        // AUTHENTICATION & USER MANAGEMENT
        // ============================================
        
        // Initialize default admin user
        function initializeUsers() {
            const users = getUsers();
            if (users.length === 0) {
                // Add default user
                const defaultUser = {
                    name: 'Sainath Premkumar',
                    username: 'sainath premkumar',
                    password: 'sai@thai6291',
                    role: 'admin',
                    createdDate: new Date().toISOString()
                };
                users.push(defaultUser);
                saveUsers(users);
            }
        }

        // Get users from localStorage
        function getUsers() {
            const users = localStorage.getItem('thaiHomesAdminUsers');
            return users ? JSON.parse(users) : [];
        }

        // Save users to localStorage
        function saveUsers(users) {
            localStorage.setItem('thaiHomesAdminUsers', JSON.stringify(users));
        }

        // Get current session
        function getCurrentSession() {
            const session = sessionStorage.getItem('thaiHomesAdminSession');
            return session ? JSON.parse(session) : null;
        }

        // Save session
        function saveSession(username, name) {
            const session = {
                username: username,
                name: name,
                loginTime: new Date().toISOString()
            };
            sessionStorage.setItem('thaiHomesAdminSession', JSON.stringify(session));
        }

        // Clear session
        function clearSession() {
            sessionStorage.removeItem('thaiHomesAdminSession');
        }

        // Check if user is logged in
        function isLoggedIn() {
            return getCurrentSession() !== null;
        }

        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            document.getElementById('loginUsername').focus();
        }

        // Hide login modal
        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginForm').reset();
            document.getElementById('loginError').style.display = 'none';
        }

        // Toggle password visibility
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
            } else {
                input.type = 'password';
            }
        }

        // Login form submission
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('loginUsername').value.trim().toLowerCase();
                    const password = document.getElementById('loginPassword').value;
                    
                    const users = getUsers();
                    const user = users.find(u => u.username.toLowerCase() === username && u.password === password);
                    
                    if (user) {
                        saveSession(user.username, user.name);
                        hideLoginModal();
                        showAdminContent();
                        displayUserList();
                    } else {
                        const errorMsg = document.getElementById('loginError');
                        errorMsg.textContent = '‚ùå Invalid username or password';
                        errorMsg.style.display = 'block';
                    }
                });
            }
        });

        // Show admin content
        function showAdminContent() {
            const session = getCurrentSession();
            if (session) {
                document.getElementById('adminLocked').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                document.getElementById('loggedInUser').textContent = session.name;
                loadComplaints();
            }
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                clearSession();
                document.getElementById('adminContent').style.display = 'none';
                document.getElementById('adminLocked').style.display = 'block';
            }
        }

        // Add new user form submission
        document.addEventListener('DOMContentLoaded', function() {
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('newUserName').value.trim();
                    const username = document.getElementById('newUsername').value.trim();
                    const password = document.getElementById('newPassword').value;
                    
                    // Check if username already exists
                    const users = getUsers();
                    if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
                        alert('‚ùå Username already exists. Please choose a different username.');
                        return;
                    }
                    
                    // Add new user
                    const newUser = {
                        name: name,
                        username: username,
                        password: password,
                        role: 'admin',
                        createdDate: new Date().toISOString()
                    };
                    
                    users.push(newUser);
                    saveUsers(users);
                    
                    // Clear form
                    this.reset();
                    
                    // Refresh user list
                    displayUserList();
                    
                    alert('‚úÖ New executive member added successfully!');
                });
            }
        });

        // Display user list
        function displayUserList() {
            const users = getUsers();
            const container = document.getElementById('userList');
            const currentSession = getCurrentSession();
            
            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">No users found</p>';
                return;
            }
            
            container.innerHTML = users.map(user => `
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-name">${user.name}${user.username === currentSession?.username ? ' (You)' : ''}</div>
                        <div class="user-username">Username: ${user.username}</div>
                    </div>
                    ${user.username !== 'sainath premkumar' ? `
                        <button class="btn-small" onclick="deleteUser('${user.username}')" style="background: #dc3545; color: white; border-color: #dc3545;">
                            üóëÔ∏è Remove
                        </button>
                    ` : '<span style="color: #2563eb; font-weight: 600;">Default Admin</span>'}
                </div>
            `).join('');
        }

        // Delete user
        function deleteUser(username) {
            if (username === 'sainath premkumar') {
                alert('‚ùå Cannot delete the default admin user.');
                return;
            }
            
            if (confirm(`Are you sure you want to remove this user?\n\nUsername: ${username}`)) {
                let users = getUsers();
                users = users.filter(u => u.username !== username);
                saveUsers(users);
                displayUserList();
                alert('‚úÖ User removed successfully!');
            }
        }

        // Check admin access when switching to admin tab
        function checkAdminAccess() {
            if (isLoggedIn()) {
                showAdminContent();
                displayUserList();
            } else {
                document.getElementById('adminLocked').style.display = 'block';
                document.getElementById('adminContent').style.display = 'none';
            }
        }

        // Initialize users on page load
        initializeUsers();

        // ============================================
        // IMPORTANT: CONFIGURE YOUR GOOGLE SCRIPT URL HERE
        // ============================================
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwjdSeypt_TLDup6eEtLFbJyc1yLmrPZAfRoRdlANHtFDkvxN9tfJlabEUahTKHL9CC/exec';
        // Replace 'YOUR_SCRIPT_URL_HERE' with your actual Google Apps Script Web App URL
        // Example: 'https://script.google.com/macros/s/AKfycbx.../exec'
        
        let allComplaints = [];

        // Initialize flat numbers
        function initializeFlatNumbers() {
            const flatSelect = document.getElementById('flatNumber');
            const filterFlat = document.getElementById('filterFlat');
            const adminFilterFlat = document.getElementById('adminFilterFlat');
            
            // Add Community Representative option first
            const commRepOption = document.createElement('option');
            commRepOption.value = 'Community Representative';
            commRepOption.textContent = 'Community Representative';
            flatSelect.appendChild(commRepOption.cloneNode(true));
            filterFlat.appendChild(commRepOption.cloneNode(true));
            if (adminFilterFlat) {
                adminFilterFlat.appendChild(commRepOption.cloneNode(true));
            }
            
            const floors = [1, 2, 3, 4, 5];
            const units = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
            
            floors.forEach(floor => {
                units.forEach(unit => {
                    const flatNumber = `${floor}${unit}`;
                    const option = document.createElement('option');
                    option.value = flatNumber;
                    option.textContent = `Flat ${flatNumber}`;
                    flatSelect.appendChild(option.cloneNode(true));
                    filterFlat.appendChild(option.cloneNode(true));
                    if (adminFilterFlat) {
                        adminFilterFlat.appendChild(option.cloneNode(true));
                    }
                });
            });
        }

        // Update block based on flat selection
        function updateBlock() {
            const flatNumber = document.getElementById('flatNumber').value;
            const blockSelect = document.getElementById('blockName');
            
            if (!flatNumber) {
                blockSelect.value = '';
                return;
            }
            
            // Handle Community Representative - Auto-select THRWA
            if (flatNumber === 'Community Representative') {
                blockSelect.value = 'THRWA';
                return;
            }
            
            const unit = flatNumber.slice(-1);
            
            if (['A', 'B', 'C', 'D', 'E', 'F'].includes(unit)) {
                blockSelect.value = 'Block A';
            } else {
                blockSelect.value = 'Block B';
            }
        }

        // Custom Category Dropdown Functions
        let selectedCategories = [];

        function toggleCategoryDropdown() {
            const header = document.querySelector('#categoryDropdown .dropdown-header');
            const list = document.getElementById('categoryList');
            
            header.classList.toggle('active');
            list.classList.toggle('active');
        }

        function selectCategory(element) {
            const value = element.getAttribute('data-value');
            const categoryError = document.getElementById('categoryError');
            const hiddenInput = document.getElementById('category');
            const submitBtn = document.getElementById('submitBtn');
            
            // Check if already selected
            if (selectedCategories.includes(value)) {
                // Deselect
                selectedCategories = selectedCategories.filter(cat => cat !== value);
                element.classList.remove('selected');
            } else {
                // Check if limit reached
                if (selectedCategories.length >= 2) {
                    alert('You can select a maximum of 2 categories only.');
                    return;
                }
                // Select
                selectedCategories.push(value);
                element.classList.add('selected');
            }
            
            // Update display
            updateCategoryDisplay();
            
            // Validate and disable/enable submit button
            if (selectedCategories.length === 2 && !selectedCategories.includes('Builder')) {
                categoryError.style.display = 'inline';
                hiddenInput.setCustomValidity('When selecting 2 categories, one must be "Builder"');
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
            } else {
                categoryError.style.display = 'none';
                hiddenInput.setCustomValidity('');
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            }
            
            // Update hidden input value
            hiddenInput.value = selectedCategories.join(', ');
        }

        function updateCategoryDisplay() {
            const headerText = document.getElementById('categoryHeaderText');
            const tagsContainer = document.getElementById('selectedCategoryTags');
            
            if (selectedCategories.length === 0) {
                headerText.textContent = 'Select category';
                headerText.classList.add('placeholder');
                tagsContainer.innerHTML = '';
            } else {
                headerText.textContent = selectedCategories.join(', ');
                headerText.classList.remove('placeholder');
                
                // Create tags
                tagsContainer.innerHTML = selectedCategories.map(cat => `
                    <div class="selected-tag">
                        <span>${cat}</span>
                        <span class="selected-tag-remove" onclick="removeCategoryTag('${cat}')">√ó</span>
                    </div>
                `).join('');
            }
        }

        function removeCategoryTag(value) {
            selectedCategories = selectedCategories.filter(cat => cat !== value);
            
            // Update the dropdown item
            const items = document.querySelectorAll('#categoryList .dropdown-item');
            items.forEach(item => {
                if (item.getAttribute('data-value') === value) {
                    item.classList.remove('selected');
                }
            });
            
            updateCategoryDisplay();
            
            // Update validation and submit button state
            const categoryError = document.getElementById('categoryError');
            const hiddenInput = document.getElementById('category');
            const submitBtn = document.getElementById('submitBtn');
            
            if (selectedCategories.length === 2 && !selectedCategories.includes('Builder')) {
                categoryError.style.display = 'inline';
                hiddenInput.setCustomValidity('When selecting 2 categories, one must be "Builder"');
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
            } else {
                categoryError.style.display = 'none';
                hiddenInput.setCustomValidity('');
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            }
            
            hiddenInput.value = selectedCategories.join(', ');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('categoryDropdown');
            if (dropdown && !dropdown.contains(event.target)) {
                const header = dropdown.querySelector('.dropdown-header');
                const list = dropdown.querySelector('.dropdown-list');
                if (header && list) {
                    header.classList.remove('active');
                    list.classList.remove('active');
                }
            }
            
            // Close filter category dropdown when clicking outside
            const filterDropdown = document.getElementById('filterCategoryDropdown');
            if (filterDropdown && !filterDropdown.contains(event.target)) {
                const filterHeader = filterDropdown.querySelector('.dropdown-header');
                const filterList = filterDropdown.querySelector('.dropdown-list');
                if (filterHeader && filterList) {
                    filterHeader.classList.remove('active');
                    filterList.classList.remove('active');
                }
            }
            
            // Close admin filter category dropdown when clicking outside
            const adminFilterDropdown = document.getElementById('adminFilterCategoryDropdown');
            if (adminFilterDropdown && !adminFilterDropdown.contains(event.target)) {
                const adminFilterHeader = adminFilterDropdown.querySelector('.dropdown-header');
                const adminFilterList = adminFilterDropdown.querySelector('.dropdown-list');
                if (adminFilterHeader && adminFilterList) {
                    adminFilterHeader.classList.remove('active');
                    adminFilterList.classList.remove('active');
                }
            }
            
            // Close dashboard filter category dropdown when clicking outside
            const dashFilterDropdown = document.getElementById('dashFilterCategoryDropdown');
            if (dashFilterDropdown && !dashFilterDropdown.contains(event.target)) {
                const dashFilterHeader = dashFilterDropdown.querySelector('.dropdown-header');
                const dashFilterList = dashFilterDropdown.querySelector('.dropdown-list');
                if (dashFilterHeader && dashFilterList) {
                    dashFilterHeader.classList.remove('active');
                    dashFilterList.classList.remove('active');
                }
            }
            
            // Close reports filter category dropdown when clicking outside
            const reportsFilterDropdown = document.getElementById('reportsFilterCategoryDropdown');
            if (reportsFilterDropdown && !reportsFilterDropdown.contains(event.target)) {
                const reportsFilterHeader = reportsFilterDropdown.querySelector('.dropdown-header');
                const reportsFilterList = reportsFilterDropdown.querySelector('.dropdown-list');
                if (reportsFilterHeader && reportsFilterList) {
                    reportsFilterHeader.classList.remove('active');
                    reportsFilterList.classList.remove('active');
                }
            }
        });

        // Filter Category Multi-Select Functions
        let selectedFilterCategories = [];

        function toggleFilterCategoryDropdown() {
            const header = document.querySelector('#filterCategoryDropdown .dropdown-header');
            const list = document.getElementById('filterCategoryList');
            
            header.classList.toggle('active');
            list.classList.toggle('active');
        }

        function selectFilterCategory(element) {
            const value = element.getAttribute('data-value');
            
            // Check if already selected
            if (selectedFilterCategories.includes(value)) {
                // Deselect
                selectedFilterCategories = selectedFilterCategories.filter(cat => cat !== value);
                element.classList.remove('selected');
            } else {
                // Select
                selectedFilterCategories.push(value);
                element.classList.add('selected');
            }
            
            // Update display
            updateFilterCategoryDisplay();
            
            // Apply filter
            filterComplaints();
        }

        function updateFilterCategoryDisplay() {
            const headerText = document.getElementById('filterCategoryHeaderText');
            const tagsContainer = document.getElementById('filterCategoryTags');
            
            if (selectedFilterCategories.length === 0) {
                headerText.textContent = 'All Categories';
                headerText.classList.remove('placeholder');
                tagsContainer.innerHTML = '';
            } else {
                headerText.textContent = selectedFilterCategories.length === 1 
                    ? selectedFilterCategories[0] 
                    : `${selectedFilterCategories.length} categories selected`;
                headerText.classList.remove('placeholder');
                
                // Create tags
                tagsContainer.innerHTML = selectedFilterCategories.map(cat => `
                    <div class="selected-tag">
                        <span>${cat}</span>
                        <span class="selected-tag-remove" onclick="removeFilterCategoryTag('${cat}')">√ó</span>
                    </div>
                `).join('');
            }
        }

        function removeFilterCategoryTag(value) {
            selectedFilterCategories = selectedFilterCategories.filter(cat => cat !== value);
            
            // Update the dropdown item
            const items = document.querySelectorAll('#filterCategoryList .dropdown-item');
            items.forEach(item => {
                if (item.getAttribute('data-value') === value) {
                    item.classList.remove('selected');
                }
            });
            
            updateFilterCategoryDisplay();
            filterComplaints();
        }

        // Admin Filter Category Multi-Select Functions
        let selectedAdminFilterCategories = [];

        function toggleAdminFilterCategoryDropdown() {
            const header = document.querySelector('#adminFilterCategoryDropdown .dropdown-header');
            const list = document.getElementById('adminFilterCategoryList');
            
            header.classList.toggle('active');
            list.classList.toggle('active');
        }

        function selectAdminFilterCategory(element) {
            const value = element.getAttribute('data-value');
            
            // Check if already selected
            if (selectedAdminFilterCategories.includes(value)) {
                // Deselect
                selectedAdminFilterCategories = selectedAdminFilterCategories.filter(cat => cat !== value);
                element.classList.remove('selected');
            } else {
                // Select
                selectedAdminFilterCategories.push(value);
                element.classList.add('selected');
            }
            
            // Update display
            updateAdminFilterCategoryDisplay();
            
            // Apply filter
            filterAdminComplaints();
        }

        function updateAdminFilterCategoryDisplay() {
            const headerText = document.getElementById('adminFilterCategoryHeaderText');
            const tagsContainer = document.getElementById('adminFilterCategoryTags');
            
            if (selectedAdminFilterCategories.length === 0) {
                headerText.textContent = 'All Categories';
                headerText.classList.remove('placeholder');
                tagsContainer.innerHTML = '';
            } else {
                headerText.textContent = selectedAdminFilterCategories.length === 1 
                    ? selectedAdminFilterCategories[0] 
                    : `${selectedAdminFilterCategories.length} categories selected`;
                headerText.classList.remove('placeholder');
                
                // Create tags
                tagsContainer.innerHTML = selectedAdminFilterCategories.map(cat => `
                    <div class="selected-tag">
                        <span>${cat}</span>
                        <span class="selected-tag-remove" onclick="removeAdminFilterCategoryTag('${cat}')">√ó</span>
                    </div>
                `).join('');
            }
        }

        function removeAdminFilterCategoryTag(value) {
            selectedAdminFilterCategories = selectedAdminFilterCategories.filter(cat => cat !== value);
            
            // Update the dropdown item
            const items = document.querySelectorAll('#adminFilterCategoryList .dropdown-item');
            items.forEach(item => {
                if (item.getAttribute('data-value') === value) {
                    item.classList.remove('selected');
                }
            });
            
            updateAdminFilterCategoryDisplay();
            filterAdminComplaints();
        }

        // Filter Admin Complaints
        function filterAdminComplaints() {
            displayAdminComplaints();
        }

        // ============================================
        // DASHBOARD FUNCTIONS
        // ============================================

        let dashboardCharts = {
            status: null,
            category: null,
            block: null,
            priority: null,
            trend: null
        };

        // Register datalabels plugin but disable by default
        Chart.register(ChartDataLabels);
        Chart.defaults.set('plugins.datalabels', {
            display: false
        });

        let selectedDashFilterCategories = [];

        // Dashboard Filter Category Multi-Select Functions
        function toggleDashFilterCategoryDropdown() {
            const header = document.querySelector('#dashFilterCategoryDropdown .dropdown-header');
            const list = document.getElementById('dashFilterCategoryList');
            
            header.classList.toggle('active');
            list.classList.toggle('active');
        }

        function selectDashFilterCategory(element) {
            const value = element.getAttribute('data-value');
            
            if (selectedDashFilterCategories.includes(value)) {
                selectedDashFilterCategories = selectedDashFilterCategories.filter(cat => cat !== value);
                element.classList.remove('selected');
            } else {
                selectedDashFilterCategories.push(value);
                element.classList.add('selected');
            }
            
            updateDashFilterCategoryDisplay();
            updateDashboard();
        }

        function updateDashFilterCategoryDisplay() {
            const headerText = document.getElementById('dashFilterCategoryHeaderText');
            const tagsContainer = document.getElementById('dashFilterCategoryTags');
            
            if (selectedDashFilterCategories.length === 0) {
                headerText.textContent = 'All Categories';
                headerText.classList.remove('placeholder');
                tagsContainer.innerHTML = '';
            } else {
                headerText.textContent = selectedDashFilterCategories.length === 1 
                    ? selectedDashFilterCategories[0] 
                    : `${selectedDashFilterCategories.length} categories selected`;
                headerText.classList.remove('placeholder');
                
                tagsContainer.innerHTML = selectedDashFilterCategories.map(cat => `
                    <div class="selected-tag">
                        <span>${cat}</span>
                        <span class="selected-tag-remove" onclick="removeDashFilterCategoryTag('${cat}')">√ó</span>
                    </div>
                `).join('');
            }
        }

        function removeDashFilterCategoryTag(value) {
            selectedDashFilterCategories = selectedDashFilterCategories.filter(cat => cat !== value);
            
            const items = document.querySelectorAll('#dashFilterCategoryList .dropdown-item');
            items.forEach(item => {
                if (item.getAttribute('data-value') === value) {
                    item.classList.remove('selected');
                }
            });
            
            updateDashFilterCategoryDisplay();
            updateDashboard();
        }

        // Get filtered complaints for dashboard
        function getFilteredDashboardComplaints() {
            let complaints = [...allComplaints];

            const statusFilter = document.getElementById('dashFilterStatus').value;
            const blockFilter = document.getElementById('dashFilterBlock').value;
            const flatFilter = document.getElementById('dashFilterFlat').value;

            if (statusFilter) {
                complaints = complaints.filter(c => c.status === statusFilter);
            }
            
            if (selectedDashFilterCategories.length > 0) {
                complaints = complaints.filter(c => {
                    const complaintCategories = c.category.split(',').map(cat => cat.trim());
                    return selectedDashFilterCategories.some(filterCat => 
                        complaintCategories.includes(filterCat)
                    );
                });
            }
            
            if (blockFilter) {
                complaints = complaints.filter(c => c.blockName === blockFilter);
            }
            if (flatFilter) {
                complaints = complaints.filter(c => c.flatNumber === flatFilter);
            }

            return complaints;
        }

        // Initialize Dashboard
        function initializeDashboard() {
            if (!document.getElementById('statusChart')) {
                return;
            }
            
            // Populate dashboard flat filter
            const dashFilterFlat = document.getElementById('dashFilterFlat');
            if (dashFilterFlat && dashFilterFlat.options.length === 1) {
                const commRepOption = document.createElement('option');
                commRepOption.value = 'Community Representative';
                commRepOption.textContent = 'Community Representative';
                dashFilterFlat.appendChild(commRepOption);
                
                const floors = [1, 2, 3, 4, 5];
                const units = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
                
                floors.forEach(floor => {
                    units.forEach(unit => {
                        const flatNumber = `${floor}${unit}`;
                        const option = document.createElement('option');
                        option.value = flatNumber;
                        option.textContent = `Flat ${flatNumber}`;
                        dashFilterFlat.appendChild(option);
                    });
                });
            }
            
            updateDashboard();
        }

        // Update Dashboard
        function updateDashboard() {
            const complaints = getFilteredDashboardComplaints();
            
            // Update summary statistics
            document.getElementById('dashTotalComplaints').textContent = complaints.length;
            document.getElementById('dashPendingComplaints').textContent = complaints.filter(c => c.status === 'Pending').length;
            document.getElementById('dashInitiatedComplaints').textContent = complaints.filter(c => c.status === 'Initiated').length;
            document.getElementById('dashInProgressComplaints').textContent = complaints.filter(c => c.status === 'In Progress').length;
            document.getElementById('dashResolvedComplaints').textContent = complaints.filter(c => c.status === 'Resolved').length;
            
            // Update all charts
            updateStatusChart(complaints);
            updateCategoryChart(complaints);
            updateBlockChart(complaints);
            updatePriorityChart(complaints);
            updateTrendChart(complaints);
        }

        // Helper function to get chart text color based on dark mode
        function getChartTextColor() {
            return document.body.classList.contains('dark-mode') ? '#e8ebe9' : '#666';
        }

        function getChartGridColor() {
            return document.body.classList.contains('dark-mode') ? '#3a4441' : '#e0e0e0';
        }

        // Status Distribution Chart
        function updateStatusChart(complaints) {
            const ctx = document.getElementById('statusChart');
            if (!ctx) return;

            const statusData = {
                'Pending': complaints.filter(c => c.status === 'Pending').length,
                'Initiated': complaints.filter(c => c.status === 'Initiated').length,
                'In Progress': complaints.filter(c => c.status === 'In Progress').length,
                'Resolved': complaints.filter(c => c.status === 'Resolved').length
            };

            if (dashboardCharts.status) {
                dashboardCharts.status.destroy();
            }

            dashboardCharts.status = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusData),
                    datasets: [{
                        data: Object.values(statusData),
                        backgroundColor: ['#ffc107', '#9c27b0', '#2196f3', '#4caf50'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: { size: 12 },
                                color: getChartTextColor()
                            }
                        },
                        datalabels: {
                            display: true,
                            color: 'white',
                            font: {
                                weight: 'bold',
                                size: 13
                            },
                            textStrokeColor: '#333',
                            textStrokeWidth: 3,
                            anchor: 'center',
                            align: 'center',
                            formatter: (value, ctx) => {
                                if (value === 0) return '';
                                const total = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return value + '\n' + percentage + '%';
                            }
                        }
                    }
                }
            });
        }

        // Category Distribution Chart
        function updateCategoryChart(complaints) {
            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;

            const categoryCount = {};
            complaints.forEach(c => {
                const categories = c.category.split(',').map(cat => cat.trim());
                categories.forEach(cat => {
                    categoryCount[cat] = (categoryCount[cat] || 0) + 1;
                });
            });

            // Get top 8 categories
            const sortedCategories = Object.entries(categoryCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8);

            if (dashboardCharts.category) {
                dashboardCharts.category.destroy();
            }

            dashboardCharts.category = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedCategories.map(([cat]) => cat),
                    datasets: [{
                        label: 'Number of Complaints',
                        data: sortedCategories.map(([, count]) => count),
                        backgroundColor: '#b8956a',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14
                            },
                            anchor: 'center',
                            align: 'center',
                            formatter: (value) => value
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                stepSize: 1,
                                color: getChartTextColor()
                            },
                            grid: {
                                color: getChartGridColor()
                            }
                        },
                        x: {
                            ticks: {
                                color: getChartTextColor()
                            },
                            grid: {
                                color: getChartGridColor()
                            }
                        }
                    }
                }
            });
        }

        // Block Distribution Chart
        function updateBlockChart(complaints) {
            const ctx = document.getElementById('blockChart');
            if (!ctx) return;

            const blockData = {
                'Block A': complaints.filter(c => c.blockName === 'Block A').length,
                'Block B': complaints.filter(c => c.blockName === 'Block B').length,
                'THRWA': complaints.filter(c => c.blockName === 'THRWA').length
            };

            if (dashboardCharts.block) {
                dashboardCharts.block.destroy();
            }

            dashboardCharts.block = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(blockData),
                    datasets: [{
                        data: Object.values(blockData),
                        backgroundColor: ['#ff6384', '#36a2eb', '#ffce56'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: { size: 12 },
                                color: getChartTextColor()
                            }
                        },
                        datalabels: {
                            display: true,
                            color: 'white',
                            font: {
                                weight: 'bold',
                                size: 13
                            },
                            textStrokeColor: '#333',
                            textStrokeWidth: 3,
                            anchor: 'center',
                            align: 'center',
                            formatter: (value, ctx) => {
                                if (value === 0) return '';
                                const total = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return value + '\n' + percentage + '%';
                            }
                        }
                    }
                }
            });
        }

        // Priority Distribution Chart
        function updatePriorityChart(complaints) {
            const ctx = document.getElementById('priorityChart');
            if (!ctx) return;

            const priorityData = {
                'Low': complaints.filter(c => c.priority === 'Low').length,
                'Medium': complaints.filter(c => c.priority === 'Medium').length,
                'High': complaints.filter(c => c.priority === 'High').length,
                'Urgent': complaints.filter(c => c.priority === 'Urgent').length
            };

            if (dashboardCharts.priority) {
                dashboardCharts.priority.destroy();
            }

            dashboardCharts.priority = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(priorityData),
                    datasets: [{
                        label: 'Number of Complaints',
                        data: Object.values(priorityData),
                        backgroundColor: ['#4caf50', '#ff9800', '#f44336', '#9c27b0'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            display: true,
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14
                            },
                            anchor: 'center',
                            align: 'center',
                            formatter: (value) => value
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                stepSize: 1,
                                color: getChartTextColor()
                            },
                            grid: {
                                color: getChartGridColor()
                            }
                        },
                        x: {
                            ticks: {
                                color: getChartTextColor()
                            },
                            grid: {
                                color: getChartGridColor()
                            }
                        }
                    }
                }
            });
        }

        // Trend Chart (Last 30 Days)
        function updateTrendChart(complaints) {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;

            const last30Days = [];
            const today = new Date();
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                last30Days.push({
                    date: date.toISOString().split('T')[0],
                    label: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
                });
            }

            const trendData = last30Days.map(day => {
                return complaints.filter(c => {
                    const complaintDate = new Date(c.dateRegistered).toISOString().split('T')[0];
                    return complaintDate === day.date;
                }).length;
            });

            if (dashboardCharts.trend) {
                dashboardCharts.trend.destroy();
            }

            dashboardCharts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last30Days.map(d => d.label),
                    datasets: [{
                        label: 'Complaints Registered',
                        data: trendData,
                        borderColor: '#7a9b76',
                        backgroundColor: 'rgba(122, 155, 118, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4,
                        pointBackgroundColor: '#7a9b76'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: getChartTextColor()
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                stepSize: 1,
                                color: getChartTextColor()
                            },
                            grid: {
                                color: getChartGridColor()
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45,
                                color: getChartTextColor()
                            },
                            grid: {
                                color: getChartGridColor()
                            }
                        }
                    }
                }
            });
        }

        // Update Dashboard Table
        function updateDashboardTable(complaints) {
            const tableBody = document.getElementById('dashboardTableBody');
            if (!tableBody) return;

            if (complaints.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="14" class="table-empty-state">No complaints to display</td></tr>';
                return;
            }

            // Sort by date (newest first)
            const sortedComplaints = [...complaints].sort((a, b) => 
                new Date(b.dateRegistered) - new Date(a.dateRegistered)
            );

            tableBody.innerHTML = sortedComplaints.map(complaint => {
                const statusClass = complaint.status.toLowerCase().replace(' ', '-');
                const priorityClass = complaint.priority.toLowerCase();
                
                // Format dates
                const dateRegistered = complaint.dateRegistered 
                    ? new Date(complaint.dateRegistered).toLocaleDateString('en-US', { 
                        year: 'numeric', month: 'short', day: 'numeric' 
                    }) 
                    : '-';
                
                const lastUpdated = complaint.lastUpdated 
                    ? new Date(complaint.lastUpdated).toLocaleDateString('en-US', { 
                        year: 'numeric', month: 'short', day: 'numeric' 
                    }) 
                    : '-';
                
                const resolvedDate = complaint.issueResolvedDate 
                    ? new Date(complaint.issueResolvedDate).toLocaleDateString('en-US', { 
                        year: 'numeric', month: 'short', day: 'numeric' 
                    }) 
                    : '-';
                
                // Format flat number display
                const flatDisplay = complaint.flatNumber === 'Community Representative' 
                    ? 'Community Representative' 
                    : `Flat ${complaint.flatNumber}`;
                
                return `
                    <tr>
                        <td style="font-weight: 600; color: #5d7a5a;">${complaint.id}</td>
                        <td>${dateRegistered}</td>
                        <td>${complaint.blockName || '-'}</td>
                        <td>${flatDisplay}</td>
                        <td>${complaint.residentName || '-'}</td>
                        <td>${complaint.contactNumber || '-'}</td>
                        <td>${complaint.category || '-'}</td>
                        <td><span class="table-priority-${priorityClass}">${complaint.priority}</span></td>
                        <td><span class="table-status-badge table-status-${statusClass}">${complaint.status}</span></td>
                        <td style="max-width: 300px; white-space: normal;">${complaint.description || '-'}</td>
                        <td>${resolvedDate}</td>
                        <td>${complaint.resolvedBy || '-'}</td>
                        <td>${complaint.supervisor || '-'}</td>
                        <td>${lastUpdated}</td>
                    </tr>
                `;
            }).join('');
        }

        // Export Table to CSV
        function exportTableToCSV() {
            const complaints = getFilteredDashboardComplaints();
            
            if (complaints.length === 0) {
                alert('No data to export!');
                return;
            }

            // Sort by date (newest first)
            const sortedComplaints = [...complaints].sort((a, b) => 
                new Date(b.dateRegistered) - new Date(a.dateRegistered)
            );

            // Define CSV headers
            const headers = [
                'Complaint ID',
                'Date Registered',
                'Block',
                'Flat Number',
                'Resident Name',
                'Contact Number',
                'Category',
                'Priority',
                'Status',
                'Description',
                'Issue Resolved Date',
                'Resolved By',
                'Supervisor',
                'Last Updated'
            ];

            // Build CSV content
            let csvContent = headers.join(',') + '\n';

            sortedComplaints.forEach(complaint => {
                const dateRegistered = complaint.dateRegistered 
                    ? new Date(complaint.dateRegistered).toLocaleDateString('en-US') 
                    : '';
                
                const lastUpdated = complaint.lastUpdated 
                    ? new Date(complaint.lastUpdated).toLocaleDateString('en-US') 
                    : '';
                
                const resolvedDate = complaint.issueResolvedDate 
                    ? new Date(complaint.issueResolvedDate).toLocaleDateString('en-US') 
                    : '';
                
                const flatDisplay = complaint.flatNumber === 'Community Representative' 
                    ? 'Community Representative' 
                    : `Flat ${complaint.flatNumber}`;
                
                // Escape and format values for CSV
                const escapeCSV = (value) => {
                    if (!value) return '';
                    value = String(value).replace(/"/g, '""'); // Escape quotes
                    if (value.includes(',') || value.includes('\n') || value.includes('"')) {
                        return `"${value}"`;
                    }
                    return value;
                };

                const row = [
                    escapeCSV(complaint.id),
                    escapeCSV(dateRegistered),
                    escapeCSV(complaint.blockName),
                    escapeCSV(flatDisplay),
                    escapeCSV(complaint.residentName),
                    escapeCSV(complaint.contactNumber),
                    escapeCSV(complaint.category),
                    escapeCSV(complaint.priority),
                    escapeCSV(complaint.status),
                    escapeCSV(complaint.description),
                    escapeCSV(resolvedDate),
                    escapeCSV(complaint.resolvedBy),
                    escapeCSV(complaint.supervisor),
                    escapeCSV(lastUpdated)
                ];

                csvContent += row.join(',') + '\n';
            });

            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const timestamp = new Date().toISOString().split('T')[0];
            link.setAttribute('href', url);
            link.setAttribute('download', `THRWA_Complaints_${timestamp}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ============================================
        // REPORTS TABLE FUNCTIONS
        // ============================================

        let selectedReportsFilterCategories = [];

        // Reports Filter Category Multi-Select Functions
        function toggleReportsFilterCategoryDropdown() {
            const header = document.querySelector('#reportsFilterCategoryDropdown .dropdown-header');
            const list = document.getElementById('reportsFilterCategoryList');
            
            header.classList.toggle('active');
            list.classList.toggle('active');
        }

        function selectReportsFilterCategory(element) {
            const value = element.getAttribute('data-value');
            
            if (selectedReportsFilterCategories.includes(value)) {
                selectedReportsFilterCategories = selectedReportsFilterCategories.filter(cat => cat !== value);
                element.classList.remove('selected');
            } else {
                selectedReportsFilterCategories.push(value);
                element.classList.add('selected');
            }
            
            updateReportsFilterCategoryDisplay();
            updateReportsTable();
        }

        function updateReportsFilterCategoryDisplay() {
            const headerText = document.getElementById('reportsFilterCategoryHeaderText');
            const tagsContainer = document.getElementById('reportsFilterCategoryTags');
            
            if (selectedReportsFilterCategories.length === 0) {
                headerText.textContent = 'All Categories';
                headerText.classList.remove('placeholder');
                tagsContainer.innerHTML = '';
            } else {
                headerText.textContent = selectedReportsFilterCategories.length === 1 
                    ? selectedReportsFilterCategories[0] 
                    : `${selectedReportsFilterCategories.length} categories selected`;
                headerText.classList.remove('placeholder');
                
                tagsContainer.innerHTML = selectedReportsFilterCategories.map(cat => `
                    <div class="selected-tag">
                        <span>${cat}</span>
                        <span class="selected-tag-remove" onclick="removeReportsFilterCategoryTag('${cat}')">√ó</span>
                    </div>
                `).join('');
            }
        }

        function removeReportsFilterCategoryTag(value) {
            selectedReportsFilterCategories = selectedReportsFilterCategories.filter(cat => cat !== value);
            
            const items = document.querySelectorAll('#reportsFilterCategoryList .dropdown-item');
            items.forEach(item => {
                if (item.getAttribute('data-value') === value) {
                    item.classList.remove('selected');
                }
            });
            
            updateReportsFilterCategoryDisplay();
            updateReportsTable();
        }

        // Get filtered complaints for reports
        function getFilteredReportsComplaints() {
            let complaints = [...allComplaints];

            const statusFilter = document.getElementById('reportsFilterStatus').value;
            const blockFilter = document.getElementById('reportsFilterBlock').value;
            const flatFilter = document.getElementById('reportsFilterFlat').value;

            if (statusFilter) {
                complaints = complaints.filter(c => c.status === statusFilter);
            }
            
            if (selectedReportsFilterCategories.length > 0) {
                complaints = complaints.filter(c => {
                    const complaintCategories = c.category.split(',').map(cat => cat.trim());
                    return selectedReportsFilterCategories.some(filterCat => 
                        complaintCategories.includes(filterCat)
                    );
                });
            }
            
            if (blockFilter) {
                complaints = complaints.filter(c => c.blockName === blockFilter);
            }
            if (flatFilter) {
                complaints = complaints.filter(c => c.flatNumber === flatFilter);
            }

            return complaints;
        }

        // Initialize Reports Table
        function initializeReportsTable() {
            if (!document.getElementById('reportsTable')) {
                return;
            }
            
            // Populate reports flat filter
            const reportsFilterFlat = document.getElementById('reportsFilterFlat');
            if (reportsFilterFlat && reportsFilterFlat.options.length === 1) {
                const commRepOption = document.createElement('option');
                commRepOption.value = 'Community Representative';
                commRepOption.textContent = 'Community Representative';
                reportsFilterFlat.appendChild(commRepOption);
                
                const floors = [1, 2, 3, 4, 5];
                const units = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
                
                floors.forEach(floor => {
                    units.forEach(unit => {
                        const flatNumber = `${floor}${unit}`;
                        const option = document.createElement('option');
                        option.value = flatNumber;
                        option.textContent = `Flat ${flatNumber}`;
                        reportsFilterFlat.appendChild(option);
                    });
                });
            }
            
            updateReportsTable();
        }

        // Update Reports Table
        function updateReportsTable() {
            const complaints = getFilteredReportsComplaints();
            
            // Update summary statistics
            document.getElementById('reportsTotalComplaints').textContent = complaints.length;
            document.getElementById('reportsPendingComplaints').textContent = complaints.filter(c => c.status === 'Pending').length;
            document.getElementById('reportsInitiatedComplaints').textContent = complaints.filter(c => c.status === 'Initiated').length;
            document.getElementById('reportsInProgressComplaints').textContent = complaints.filter(c => c.status === 'In Progress').length;
            document.getElementById('reportsResolvedComplaints').textContent = complaints.filter(c => c.status === 'Resolved').length;
            
            // Update table
            const tableBody = document.getElementById('reportsTableBody');
            if (!tableBody) return;

            if (complaints.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="14" class="table-empty-state">No complaints to display</td></tr>';
                return;
            }

            // Sort by date (newest first)
            const sortedComplaints = [...complaints].sort((a, b) => 
                new Date(b.dateRegistered) - new Date(a.dateRegistered)
            );

            tableBody.innerHTML = sortedComplaints.map(complaint => {
                const statusClass = complaint.status.toLowerCase().replace(' ', '-');
                const priorityClass = complaint.priority.toLowerCase();
                
                const dateRegistered = complaint.dateRegistered 
                    ? new Date(complaint.dateRegistered).toLocaleDateString('en-US', { 
                        year: 'numeric', month: 'short', day: 'numeric' 
                    }) 
                    : '-';
                
                const lastUpdated = complaint.lastUpdated 
                    ? new Date(complaint.lastUpdated).toLocaleDateString('en-US', { 
                        year: 'numeric', month: 'short', day: 'numeric' 
                    }) 
                    : '-';
                
                const resolvedDate = complaint.issueResolvedDate 
                    ? new Date(complaint.issueResolvedDate).toLocaleDateString('en-US', { 
                        year: 'numeric', month: 'short', day: 'numeric' 
                    }) 
                    : '-';
                
                const flatDisplay = complaint.flatNumber === 'Community Representative' 
                    ? 'Community Representative' 
                    : `Flat ${complaint.flatNumber}`;
                
                return `
                    <tr>
                        <td style="font-weight: 600; color: #5d7a5a;">${complaint.id}</td>
                        <td>${dateRegistered}</td>
                        <td>${complaint.blockName || '-'}</td>
                        <td>${flatDisplay}</td>
                        <td>${complaint.residentName || '-'}</td>
                        <td>${complaint.contactNumber || '-'}</td>
                        <td>${complaint.category || '-'}</td>
                        <td><span class="table-priority-${priorityClass}">${complaint.priority}</span></td>
                        <td><span class="table-status-badge table-status-${statusClass}">${complaint.status}</span></td>
                        <td style="max-width: 300px; white-space: normal;">${complaint.description || '-'}</td>
                        <td>${resolvedDate}</td>
                        <td>${complaint.resolvedBy || '-'}</td>
                        <td>${complaint.supervisor || '-'}</td>
                        <td>${lastUpdated}</td>
                    </tr>
                `;
            }).join('');
        }

        // Export Reports Table to CSV
        function exportReportsTableToCSV() {
            const complaints = getFilteredReportsComplaints();
            
            if (complaints.length === 0) {
                alert('No data to export!');
                return;
            }

            const sortedComplaints = [...complaints].sort((a, b) => 
                new Date(b.dateRegistered) - new Date(a.dateRegistered)
            );

            const headers = [
                'Complaint ID',
                'Date Registered',
                'Block',
                'Flat Number',
                'Resident Name',
                'Contact Number',
                'Category',
                'Priority',
                'Status',
                'Description',
                'Issue Resolved Date',
                'Resolved By',
                'Supervisor',
                'Last Updated'
            ];

            let csvContent = headers.join(',') + '\n';

            sortedComplaints.forEach(complaint => {
                const dateRegistered = complaint.dateRegistered 
                    ? new Date(complaint.dateRegistered).toLocaleDateString('en-US') 
                    : '';
                
                const lastUpdated = complaint.lastUpdated 
                    ? new Date(complaint.lastUpdated).toLocaleDateString('en-US') 
                    : '';
                
                const resolvedDate = complaint.issueResolvedDate 
                    ? new Date(complaint.issueResolvedDate).toLocaleDateString('en-US') 
                    : '';
                
                const flatDisplay = complaint.flatNumber === 'Community Representative' 
                    ? 'Community Representative' 
                    : `Flat ${complaint.flatNumber}`;
                
                const escapeCSV = (value) => {
                    if (!value) return '';
                    value = String(value).replace(/"/g, '""');
                    if (value.includes(',') || value.includes('\n') || value.includes('"')) {
                        return `"${value}"`;
                    }
                    return value;
                };

                const row = [
                    escapeCSV(complaint.id),
                    escapeCSV(dateRegistered),
                    escapeCSV(complaint.blockName),
                    escapeCSV(flatDisplay),
                    escapeCSV(complaint.residentName),
                    escapeCSV(complaint.contactNumber),
                    escapeCSV(complaint.category),
                    escapeCSV(complaint.priority),
                    escapeCSV(complaint.status),
                    escapeCSV(complaint.description),
                    escapeCSV(resolvedDate),
                    escapeCSV(complaint.resolvedBy),
                    escapeCSV(complaint.supervisor),
                    escapeCSV(lastUpdated)
                ];

                csvContent += row.join(',') + '\n';
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const timestamp = new Date().toISOString().split('T')[0];
            link.setAttribute('href', url);
            link.setAttribute('download', `THRWA_Reports_${timestamp}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Generate unique complaint ID
        function generateComplaintId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `CMP${timestamp}${random}`;
        }

        // Check if script URL is configured
        function isConfigured() {
            if (SCRIPT_URL === 'YOUR_SCRIPT_URL_HERE') {
                return false;
            }
            return true;
        }

        // Show message
        function showMessage(elementId, message, duration = 5000) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            
            if (duration > 0) {
                setTimeout(() => {
                    element.style.display = 'none';
                }, duration);
            }
        }

        // Load complaints from Google Sheets
        async function loadComplaints() {
            if (!isConfigured()) {
                showMessage('viewInfoMessage', '‚ö†Ô∏è Please configure the Google Script URL in the HTML file.', 0);
                return;
            }

            try {
                showMessage('viewInfoMessage', '‚è≥ Loading complaints from Google Sheets...', 0);
                
                const response = await fetch(SCRIPT_URL);
                const result = await response.json();
                
                if (result.success) {
                    allComplaints = result.complaints || [];
                    displayComplaints();
                    updateStats();
                    document.getElementById('viewInfoMessage').style.display = 'none';
                } else {
                    showMessage('viewInfoMessage', '‚ùå Error loading complaints: ' + result.message, 0);
                }
            } catch (error) {
                showMessage('viewInfoMessage', '‚ùå Error connecting to Google Sheets: ' + error.message, 0);
            }
        }

        // Handle form submission
        document.getElementById('complaintForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!isConfigured()) {
                showMessage('errorMessage', '‚ö†Ô∏è Please configure the Google Script URL in the HTML file.');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner"></span> Submitting...';

            // Get selected categories from hidden input
            const categoryValue = document.getElementById('category').value;

            const complaint = {
                action: 'submit',
                id: generateComplaintId(),
                blockName: document.getElementById('blockName').value,
                flatNumber: document.getElementById('flatNumber').value,
                residentName: document.getElementById('residentName').value,
                contactNumber: document.getElementById('contactNumber').value || 'Not Provided',
                category: categoryValue,
                priority: document.getElementById('priority').value,
                description: document.getElementById('description').value,
                status: 'Pending',
                dateRegistered: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(complaint)
                });

                // Note: no-cors mode doesn't allow reading response, so we assume success
                document.getElementById('complaintIdDisplay').textContent = complaint.id;
                showMessage('successMessage', `‚úì Complaint registered successfully! Your complaint ID is ${complaint.id}`);
                
                this.reset();
                document.getElementById('blockName').value = '';
                
                // Reset category dropdown
                selectedCategories = [];
                document.querySelectorAll('#categoryList .dropdown-item').forEach(item => {
                    item.classList.remove('selected');
                });
                updateCategoryDisplay();
                
                // Reload complaints after a short delay
                setTimeout(() => loadComplaints(), 2000);
                
            } catch (error) {
                showMessage('errorMessage', '‚ùå Error submitting complaint: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Complaint';
            }
        });


        // Display complaints in view tab
        function displayComplaints() {
            const container = document.getElementById('complaintsContainer');
            let complaints = [...allComplaints];

            // Apply filters
            const statusFilter = document.getElementById('filterStatus').value;
            const blockFilter = document.getElementById('filterBlock').value;
            const flatFilter = document.getElementById('filterFlat').value;

            if (statusFilter) {
                complaints = complaints.filter(c => c.status === statusFilter);
            }
            
            // Multi-select category filter
            if (selectedFilterCategories.length > 0) {
                complaints = complaints.filter(c => {
                    // Check if complaint category matches any selected filter category
                    // Handle both single and multiple categories in complaint
                    const complaintCategories = c.category.split(',').map(cat => cat.trim());
                    return selectedFilterCategories.some(filterCat => 
                        complaintCategories.includes(filterCat)
                    );
                });
            }
            
            if (blockFilter) {
                complaints = complaints.filter(c => c.blockName === blockFilter);
            }
            if (flatFilter) {
                complaints = complaints.filter(c => c.flatNumber === flatFilter);
            }

            if (complaints.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3>No complaints found</h3>
                        <p>No complaints match your filter criteria</p>
                    </div>
                `;
                return;
            }

            // Sort by date (newest first)
            complaints.sort((a, b) => new Date(b.dateRegistered) - new Date(a.dateRegistered));

            container.innerHTML = complaints.map(complaint => {
                const hasResolutionData = complaint.issueResolvedDate || complaint.resolvedBy || complaint.supervisor;
                
                return `
                <div class="complaint-card">
                    <div class="complaint-header">
                        <span class="complaint-id">${complaint.id}</span>
                        <span class="status-badge status-${complaint.status.toLowerCase().replace(' ', '-')}">${complaint.status}</span>
                    </div>
                    <div class="complaint-info">
                        <div class="info-item">
                            <span class="info-label">Block</span>
                            <span class="info-value">${complaint.blockName || 'N/A'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Flat Number</span>
                            <span class="info-value">${complaint.flatNumber === 'Community Representative' ? 'Community Representative' : 'Flat ' + complaint.flatNumber}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Resident Name</span>
                            <span class="info-value">${complaint.residentName}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Category</span>
                            <span class="info-value">${complaint.category}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Priority</span>
                            <span class="info-value">${complaint.priority}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Registered On</span>
                            <span class="info-value">${new Date(complaint.dateRegistered).toLocaleDateString('en-IN')}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Contact</span>
                            <span class="info-value">${complaint.contactNumber}</span>
                        </div>
                    </div>
                    <div class="complaint-description">
                        <strong>Description:</strong><br>
                        ${complaint.description}
                    </div>
                    
                    ${hasResolutionData ? `
                        <div class="resolution-details-container">
                            <strong class="resolution-details-title">üìã Resolution Details:</strong>
                            <div class="resolution-details-grid">
                                ${complaint.issueResolvedDate ? `
                                    <div>
                                        <span class="resolution-detail-label">Resolved Date:</span><br>
                                        <span class="resolution-detail-value">${new Date(complaint.issueResolvedDate).toLocaleDateString('en-IN')}</span>
                                    </div>
                                ` : ''}
                                ${complaint.resolvedBy ? `
                                    <div>
                                        <span class="resolution-detail-label">Resolved By:</span><br>
                                        <span class="resolution-detail-value">${complaint.resolvedBy}</span>
                                    </div>
                                ` : ''}
                                ${complaint.supervisor ? `
                                    <div>
                                        <span class="resolution-detail-label">Supervisor:</span><br>
                                        <span class="resolution-detail-value">${complaint.supervisor}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
                `;
            }).join('');
        }

        // Display complaints in admin panel
        function displayAdminComplaints() {
            const container = document.getElementById('adminComplaintsContainer');
            let complaints = [...allComplaints];
            const users = getUsers();
            const userOptions = users.map(u => `<option value="${u.name}">${u.name}</option>`).join('');

            // Apply filters
            const statusFilter = document.getElementById('adminFilterStatus').value;
            const blockFilter = document.getElementById('adminFilterBlock').value;
            const flatFilter = document.getElementById('adminFilterFlat').value;

            if (statusFilter) {
                complaints = complaints.filter(c => c.status === statusFilter);
            }
            
            // Multi-select category filter
            if (selectedAdminFilterCategories.length > 0) {
                complaints = complaints.filter(c => {
                    // Check if complaint category matches any selected filter category
                    // Handle both single and multiple categories in complaint
                    const complaintCategories = c.category.split(',').map(cat => cat.trim());
                    return selectedAdminFilterCategories.some(filterCat => 
                        complaintCategories.includes(filterCat)
                    );
                });
            }
            
            if (blockFilter) {
                complaints = complaints.filter(c => c.blockName === blockFilter);
            }
            if (flatFilter) {
                complaints = complaints.filter(c => c.flatNumber === flatFilter);
            }

            if (complaints.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3>No complaints found</h3>
                        <p>No complaints match your filter criteria</p>
                    </div>
                `;
                return;
            }

            // Sort by date (newest first)
            complaints.sort((a, b) => new Date(b.dateRegistered) - new Date(a.dateRegistered));

            container.innerHTML = complaints.map(complaint => {
                const isResolved = complaint.status === 'Resolved';
                const hasResolutionData = complaint.issueResolvedDate || complaint.resolvedBy || complaint.supervisor;
                
                return `
                <div class="complaint-card">
                    <div class="complaint-header">
                        <span class="complaint-id">${complaint.id}</span>
                        <span class="status-badge status-${complaint.status.toLowerCase().replace(' ', '-')}">${complaint.status}</span>
                    </div>
                    <div class="complaint-info">
                        <div class="info-item">
                            <span class="info-label">Block</span>
                            <span class="info-value">${complaint.blockName || 'N/A'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Flat Number</span>
                            <span class="info-value">${complaint.flatNumber === 'Community Representative' ? 'Community Representative' : 'Flat ' + complaint.flatNumber}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Resident Name</span>
                            <span class="info-value">${complaint.residentName}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Category</span>
                            <span class="info-value">${complaint.category}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Priority</span>
                            <span class="info-value">${complaint.priority}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Registered On</span>
                            <span class="info-value">${new Date(complaint.dateRegistered).toLocaleDateString('en-IN')}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Contact</span>
                            <span class="info-value">${complaint.contactNumber}</span>
                        </div>
                    </div>
                    <div class="complaint-description">
                        <strong>Description:</strong><br>
                        ${complaint.description}
                    </div>
                    
                    ${hasResolutionData ? `
                        <div class="resolution-details-container">
                            <strong class="resolution-details-title">üìã Resolution Details:</strong>
                            <div class="resolution-details-grid">
                                ${complaint.issueResolvedDate ? `
                                    <div>
                                        <span class="resolution-detail-label">Resolved Date:</span><br>
                                        <span class="resolution-detail-value">${new Date(complaint.issueResolvedDate).toLocaleDateString('en-IN')}</span>
                                    </div>
                                ` : ''}
                                ${complaint.resolvedBy ? `
                                    <div>
                                        <span class="resolution-detail-label">Resolved By:</span><br>
                                        <span class="resolution-detail-value">${complaint.resolvedBy}</span>
                                    </div>
                                ` : ''}
                                ${complaint.supervisor ? `
                                    <div>
                                        <span class="resolution-detail-label">Supervisor:</span><br>
                                        <span class="resolution-detail-value">${complaint.supervisor}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}

                    <div class="action-buttons">
                        ${!isResolved ? `
                            <button class="btn-small" onclick="updateStatus('${complaint.id}', 'Initiated')">Mark as Initiated</button>
                            <button class="btn-small" onclick="updateStatus('${complaint.id}', 'In Progress')">Mark In Progress</button>
                            <button class="btn-small" onclick="showResolutionForm('${complaint.id}')">‚úÖ Mark as Resolved</button>
                        ` : `
                            <button class="btn-small" onclick="updateStatus('${complaint.id}', 'In Progress')">Reopen</button>
                            <button class="btn-small" onclick="showResolutionForm('${complaint.id}')">Edit Resolution</button>
                        `}
                        <button class="btn-small" onclick="deleteComplaint('${complaint.id}')">Delete</button>
                    </div>

                    <!-- Resolution Form (Hidden by default) -->
                    <div id="resolutionForm_${complaint.id}" class="resolution-form-container" style="display: none;">
                        <h4 class="resolution-form-title">Resolution Details</h4>
                        <form onsubmit="submitResolution(event, '${complaint.id}')">
                            <div class="form-group">
                                <label for="resolvedDate_${complaint.id}">Issue Resolved Date *</label>
                                <input type="date" id="resolvedDate_${complaint.id}" value="${complaint.issueResolvedDate || ''}" required>
                            </div>
                            <div class="form-group">
                                <label for="resolvedBy_${complaint.id}">Resolved By *</label>
                                <input type="text" id="resolvedBy_${complaint.id}" placeholder="Enter person/team name" value="${complaint.resolvedBy || ''}" required>
                            </div>
                            <div class="form-group">
                                <label for="supervisor_${complaint.id}">Supervisor *</label>
                                <select id="supervisor_${complaint.id}" required>
                                    <option value="">Select Supervisor</option>
                                    ${users.map(u => `<option value="${u.name}" ${complaint.supervisor === u.name ? 'selected' : ''}>${u.name}</option>`).join('')}
                                </select>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button type="submit" class="btn" style="flex: 1;">üíæ Save Resolution</button>
                                <button type="button" class="btn-small" onclick="hideResolutionForm('${complaint.id}')" style="background: #6c757d; color: white; border-color: #6c757d;">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            `}).join('');
        }

        // Show resolution form
        function showResolutionForm(complaintId) {
            const form = document.getElementById(`resolutionForm_${complaintId}`);
            form.style.display = 'block';
            form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Hide resolution form
        function hideResolutionForm(complaintId) {
            document.getElementById(`resolutionForm_${complaintId}`).style.display = 'none';
        }

        // Submit resolution
        async function submitResolution(event, complaintId) {
            event.preventDefault();
            
            if (!isConfigured()) {
                alert('Please configure the Google Script URL in the HTML file.');
                return;
            }

            const resolvedDate = document.getElementById(`resolvedDate_${complaintId}`).value;
            const resolvedBy = document.getElementById(`resolvedBy_${complaintId}`).value;
            const supervisor = document.getElementById(`supervisor_${complaintId}`).value;

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateResolution',
                        id: complaintId,
                        status: 'Resolved',
                        issueResolvedDate: resolvedDate,
                        resolvedBy: resolvedBy,
                        supervisor: supervisor
                    })
                });

                // Hide the form
                hideResolutionForm(complaintId);
                
                // Reload complaints after update
                setTimeout(() => loadComplaints(), 1000);
                
                alert('‚úÖ Complaint marked as resolved successfully!');
                
            } catch (error) {
                alert('Error updating resolution: ' + error.message);
            }
        }

        // Update complaint status
        async function updateStatus(complaintId, newStatus) {
            if (!isConfigured()) {
                alert('Please configure the Google Script URL in the HTML file.');
                return;
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateStatus',
                        id: complaintId,
                        status: newStatus
                    })
                });

                // Reload complaints after update
                setTimeout(() => loadComplaints(), 1000);
                
            } catch (error) {
                alert('Error updating status: ' + error.message);
            }
        }

        // Delete complaint
        async function deleteComplaint(complaintId) {
            if (!confirm('Are you sure you want to delete this complaint?')) {
                return;
            }

            if (!isConfigured()) {
                alert('Please configure the Google Script URL in the HTML file.');
                return;
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'delete',
                        id: complaintId
                    })
                });

                // Reload complaints after delete
                setTimeout(() => loadComplaints(), 1000);
                
            } catch (error) {
                alert('Error deleting complaint: ' + error.message);
            }
        }

        // Update statistics
        function updateStats() {
            const complaints = allComplaints;
            
            document.getElementById('totalComplaints').textContent = complaints.length;
            document.getElementById('pendingComplaints').textContent = complaints.filter(c => c.status === 'Pending').length;
            document.getElementById('initiatedComplaints').textContent = complaints.filter(c => c.status === 'Initiated').length;
            document.getElementById('inProgressComplaints').textContent = complaints.filter(c => c.status === 'In Progress').length;
            document.getElementById('resolvedComplaints').textContent = complaints.filter(c => c.status === 'Resolved').length;
            
            displayAdminComplaints();
        }

        // Filter complaints
        function filterComplaints() {
            displayComplaints();
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            initializeFlatNumbers();
            
            // Check if configured
            if (!isConfigured()) {
                showMessage('viewInfoMessage', '‚ö†Ô∏è System not configured yet. Please configure the Google Script URL in the HTML file.', 0);
            }
        });

        // Dark Mode Toggle Functionality
        function initDarkMode() {
            // Check if dark mode preference exists in localStorage
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }
            
            // Update icon
            updateDarkModeIcon();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            
            // Save preference to localStorage
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            
            // Update icon with animation
            updateDarkModeIcon();
            
            // Refresh charts if dashboard is active to update colors
            const dashboardTab = document.getElementById('dashboardTab');
            if (dashboardTab && dashboardTab.classList.contains('active')) {
                updateDashboard();
            }
        }

        function updateDarkModeIcon() {
            const icon = document.querySelector('.dark-mode-icon');
            if (icon) {
                // Sun icon for light mode, Moon icon for dark mode
                icon.textContent = document.body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
            }
        }

        // Initialize dark mode on page load
        initDarkMode();
    </script>
</body>
</html>
