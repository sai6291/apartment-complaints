<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai Homes Residents Welfare Association</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        } <!-- This is a comment -->


        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 1em;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input[type="date"] {
            cursor: pointer;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            padding: 5px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .complaint-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .complaint-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .complaint-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .complaint-id {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1em;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-in-progress {
            background: #cfe2ff;
            color: #084298;
        }

        .status-resolved {
            background: #d1e7dd;
            color: #0f5132;
        }

        .complaint-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.85em;
            color: #6c757d;
            margin-bottom: 4px;
        }

        .info-value {
            font-weight: 600;
            color: #333;
        }

        .complaint-description {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            line-height: 1.6;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-small:hover {
            background: #667eea;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 40px;
            border-radius: 15px;
            max-width: 450px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        .close:hover {
            color: #000;
        }

        .login-form {
            margin-top: 20px;
        }

        .user-management {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .user-list {
            margin-top: 20px;
        }

        .user-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .user-username {
            font-size: 0.9em;
            color: #6c757d;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .admin-locked {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .admin-locked svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .password-toggle {
            position: relative;
        }

        .password-toggle input {
            padding-right: 45px;
        }

        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6c757d;
            user-select: none;
        }

        .toggle-password:hover {
            color: #333;
        }

        .success-message, .error-message, .info-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid;
            display: none;
        }

        .success-message {
            background: #d1e7dd;
            color: #0f5132;
            border-left-color: #0f5132;
        }

        .error-message {
            background: #f8d7da;
            color: #842029;
            border-left-color: #842029;
        }

        .info-message {
            background: #cfe2ff;
            color: #084298;
            border-left-color: #084298;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .setup-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
            margin-bottom: 25px;
        }

        .setup-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .setup-section ol {
            margin-left: 20px;
            line-height: 1.8;
        }

        .setup-section code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                padding: 15px;
            }

            .tab-content {
                padding: 20px;
            }

            .complaint-header {
                flex-direction: column;
            }

            .stat-number {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Thai Homes Residents Welfare Association</h1>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('register', event)">üìù Register Complaint</button>
            <button class="tab" onclick="switchTab('view', event)">üìã View Complaints</button>
            <button class="tab" onclick="switchTab('admin', event)">‚öôÔ∏è Admin Panel</button>
        </div>

        <!-- Register Complaint Tab -->
        <div id="register" class="tab-content active">
            <div class="success-message" id="successMessage">
                ‚úì Complaint registered successfully! Your complaint ID is <strong id="complaintIdDisplay"></strong>
            </div>
            <div class="error-message" id="errorMessage"></div>

            <form id="complaintForm">
                <div class="form-group">
                    <label for="blockName">Block *</label>
                    <select id="blockName" required disabled>
                        <option value="">Auto-selected based on flat</option>
                        <option value="Block A">Block A</option>
                        <option value="Block B">Block B</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="flatNumber">Flat Number *</label>
                    <select id="flatNumber" required onchange="updateBlock()">
                        <option value="">Select your flat number</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="residentName">Resident Name *</label>
                    <input type="text" id="residentName" placeholder="Enter your name" required>
                </div>

                <div class="form-group">
                    <label for="contactNumber">Contact Number</label>
                    <input type="tel" id="contactNumber" placeholder="Enter your mobile number (optional)" pattern="[0-9]{10}">
                </div>

                <div class="form-group">
                    <label for="category">Complaint Category *</label>
                    <select id="category" required>
                        <option value="">Select category</option>
                        <option value="Plumbing">Plumbing</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Lift">Lift/Elevator</option>
                        <option value="Water Supply">Water Supply</option>
                        <option value="Cleaning">Cleaning/Housekeeping</option>
                        <option value="Security">Security</option>
                        <option value="Parking">Parking</option>
                        <option value="Common Area">Common Area</option>
                        <option value="Noise">Noise Complaint</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="priority">Priority Level *</label>
                    <select id="priority" required>
                        <option value="">Select priority</option>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                        <option value="Urgent">Urgent</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="description">Complaint Description *</label>
                    <textarea id="description" placeholder="Please describe your complaint in detail..." required></textarea>
                </div>

                <button type="submit" class="btn" id="submitBtn">Submit Complaint</button>
            </form>
        </div>

        <!-- View Complaints Tab -->
        <div id="view" class="tab-content">
            <div class="info-message" id="viewInfoMessage"></div>
            
            <div class="filter-section">
                <div class="form-group">
                    <label for="filterStatus">Filter by Status</label>
                    <select id="filterStatus" onchange="filterComplaints()">
                        <option value="">All Statuses</option>
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="filterCategory">Filter by Category</label>
                    <select id="filterCategory" onchange="filterComplaints()">
                        <option value="">All Categories</option>
                        <option value="Plumbing">Plumbing</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Lift">Lift/Elevator</option>
                        <option value="Water Supply">Water Supply</option>
                        <option value="Cleaning">Cleaning/Housekeeping</option>
                        <option value="Security">Security</option>
                        <option value="Parking">Parking</option>
                        <option value="Common Area">Common Area</option>
                        <option value="Noise">Noise Complaint</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="filterBlock">Filter by Block</label>
                    <select id="filterBlock" onchange="filterComplaints()">
                        <option value="">All Blocks</option>
                        <option value="Block A">Block A</option>
                        <option value="Block B">Block B</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="filterFlat">Filter by Flat</label>
                    <select id="filterFlat" onchange="filterComplaints()">
                        <option value="">All Flats</option>
                    </select>
                </div>

                <div class="form-group">
                    <button class="btn" onclick="loadComplaints()" style="margin-top: 25px;">
                        üîÑ Refresh Complaints
                    </button>
                </div>
            </div>

            <div id="complaintsContainer"></div>
        </div>

        <!-- Admin Panel Tab -->
        <div id="admin" class="tab-content">
            <!-- Login Modal -->
            <div id="loginModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>üîê Admin Login</h2>
                        <p>Executive Committee Members Only</p>
                    </div>
                    <form id="loginForm" class="login-form">
                        <div class="form-group">
                            <label for="loginUsername">Username</label>
                            <input type="text" id="loginUsername" placeholder="Enter your username" required>
                        </div>
                        <div class="form-group password-toggle">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                            <span class="toggle-password" onclick="togglePasswordVisibility('loginPassword')">üëÅÔ∏è</span>
                        </div>
                        <div class="error-message" id="loginError"></div>
                        <button type="submit" class="btn">Login</button>
                    </form>
                </div>
            </div>

            <!-- Admin Content (Hidden until logged in) -->
            <div id="adminContent" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Welcome, <span id="loggedInUser"></span>!</h3>
                    <button class="logout-btn" onclick="logout()">üö™ Logout</button>
                </div>

                <!-- User Management Section -->
                <div class="user-management">
                    <h3 style="margin-bottom: 20px; color: #333;">üë• User Management</h3>
                    
                    <form id="addUserForm" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #667eea;">Add New Executive Member</h4>
                        <div class="form-group">
                            <label for="newUserName">Full Name *</label>
                            <input type="text" id="newUserName" placeholder="e.g., John Doe" required>
                        </div>
                        <div class="form-group">
                            <label for="newUsername">Username *</label>
                            <input type="text" id="newUsername" placeholder="e.g., john.doe" required>
                        </div>
                        <div class="form-group password-toggle">
                            <label for="newPassword">Password *</label>
                            <input type="password" id="newPassword" placeholder="Enter password" required>
                            <span class="toggle-password" onclick="togglePasswordVisibility('newPassword')">üëÅÔ∏è</span>
                        </div>
                        <button type="submit" class="btn">‚ûï Add User</button>
                    </form>

                    <h4 style="margin-bottom: 15px; color: #333;">Current Executive Members</h4>
                    <div class="user-list" id="userList"></div>
                </div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalComplaints">0</div>
                        <div class="stat-label">Total Complaints</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingComplaints">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="inProgressComplaints">0</div>
                        <div class="stat-label">In Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="resolvedComplaints">0</div>
                        <div class="stat-label">Resolved</div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="loadComplaints()">üîÑ Refresh Data</button>
                </div>

                <h3 style="margin-bottom: 20px; color: #333;">Manage All Complaints</h3>
                <div id="adminComplaintsContainer"></div>
            </div>

            <!-- Locked State (Shown when not logged in) -->
            <div id="adminLocked" class="admin-locked">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <h3>Admin Panel Locked</h3>
                <p>This section is restricted to Executive Committee members only.</p>
                <button class="btn" style="margin-top: 20px; max-width: 300px; margin-left: auto; margin-right: auto;" onclick="showLoginModal()">üîê Admin Login</button>
            </div>
        </div>

    </div>

    <script>
        // ============================================
        // TAB NAVIGATION (Must be defined first!)
        // ============================================
        
        // Switch tabs
        function switchTab(tabName, evt) {
            console.log('switchTab called with:', tabName);
            
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            console.log('Found tab contents:', tabContents.length);
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }

            // Remove active class from all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }

            // Show the selected tab content
            const selectedTab = document.getElementById(tabName);
            console.log('Selected tab element:', selectedTab);
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('Added active class to:', tabName);
            } else {
                console.error('Tab not found:', tabName);
            }

            // Add active class to clicked tab button
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add('active');
            }

            // Execute tab-specific actions
            if (tabName === 'view') {
                console.log('Loading complaints...');
                if (typeof loadComplaints === 'function') {
                    loadComplaints();
                }
            } else if (tabName === 'admin') {
                console.log('Checking admin access...');
                if (typeof checkAdminAccess === 'function') {
                    checkAdminAccess();
                }
            }
        }
        
        // ============================================
        // AUTHENTICATION & USER MANAGEMENT
        // ============================================
        
        // Initialize default admin user
        function initializeUsers() {
            const users = getUsers();
            if (users.length === 0) {
                // Add default user
                const defaultUser = {
                    name: 'Sainath Premkumar',
                    username: 'sainath premkumar',
                    password: 'sai@thai6291',
                    role: 'admin',
                    createdDate: new Date().toISOString()
                };
                users.push(defaultUser);
                saveUsers(users);
            }
        }

        // Get users from localStorage
        function getUsers() {
            const users = localStorage.getItem('thaiHomesAdminUsers');
            return users ? JSON.parse(users) : [];
        }

        // Save users to localStorage
        function saveUsers(users) {
            localStorage.setItem('thaiHomesAdminUsers', JSON.stringify(users));
        }

        // Get current session
        function getCurrentSession() {
            const session = sessionStorage.getItem('thaiHomesAdminSession');
            return session ? JSON.parse(session) : null;
        }

        // Save session
        function saveSession(username, name) {
            const session = {
                username: username,
                name: name,
                loginTime: new Date().toISOString()
            };
            sessionStorage.setItem('thaiHomesAdminSession', JSON.stringify(session));
        }

        // Clear session
        function clearSession() {
            sessionStorage.removeItem('thaiHomesAdminSession');
        }

        // Check if user is logged in
        function isLoggedIn() {
            return getCurrentSession() !== null;
        }

        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            document.getElementById('loginUsername').focus();
        }

        // Hide login modal
        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginForm').reset();
            document.getElementById('loginError').style.display = 'none';
        }

        // Toggle password visibility
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
            } else {
                input.type = 'password';
            }
        }

        // Login form submission
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('loginUsername').value.trim().toLowerCase();
                    const password = document.getElementById('loginPassword').value;
                    
                    const users = getUsers();
                    const user = users.find(u => u.username.toLowerCase() === username && u.password === password);
                    
                    if (user) {
                        saveSession(user.username, user.name);
                        hideLoginModal();
                        showAdminContent();
                        displayUserList();
                    } else {
                        const errorMsg = document.getElementById('loginError');
                        errorMsg.textContent = '‚ùå Invalid username or password';
                        errorMsg.style.display = 'block';
                    }
                });
            }
        });

        // Show admin content
        function showAdminContent() {
            const session = getCurrentSession();
            if (session) {
                document.getElementById('adminLocked').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                document.getElementById('loggedInUser').textContent = session.name;
                loadComplaints();
            }
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                clearSession();
                document.getElementById('adminContent').style.display = 'none';
                document.getElementById('adminLocked').style.display = 'block';
            }
        }

        // Add new user form submission
        document.addEventListener('DOMContentLoaded', function() {
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('newUserName').value.trim();
                    const username = document.getElementById('newUsername').value.trim();
                    const password = document.getElementById('newPassword').value;
                    
                    // Check if username already exists
                    const users = getUsers();
                    if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
                        alert('‚ùå Username already exists. Please choose a different username.');
                        return;
                    }
                    
                    // Add new user
                    const newUser = {
                        name: name,
                        username: username,
                        password: password,
                        role: 'admin',
                        createdDate: new Date().toISOString()
                    };
                    
                    users.push(newUser);
                    saveUsers(users);
                    
                    // Clear form
                    this.reset();
                    
                    // Refresh user list
                    displayUserList();
                    
                    alert('‚úÖ New executive member added successfully!');
                });
            }
        });

        // Display user list
        function displayUserList() {
            const users = getUsers();
            const container = document.getElementById('userList');
            const currentSession = getCurrentSession();
            
            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">No users found</p>';
                return;
            }
            
            container.innerHTML = users.map(user => `
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-name">${user.name}${user.username === currentSession?.username ? ' (You)' : ''}</div>
                        <div class="user-username">Username: ${user.username}</div>
                    </div>
                    ${user.username !== 'sainath premkumar' ? `
                        <button class="btn-small" onclick="deleteUser('${user.username}')" style="background: #dc3545; color: white; border-color: #dc3545;">
                            üóëÔ∏è Remove
                        </button>
                    ` : '<span style="color: #667eea; font-weight: 600;">Default Admin</span>'}
                </div>
            `).join('');
        }

        // Delete user
        function deleteUser(username) {
            if (username === 'sainath premkumar') {
                alert('‚ùå Cannot delete the default admin user.');
                return;
            }
            
            if (confirm(`Are you sure you want to remove this user?\n\nUsername: ${username}`)) {
                let users = getUsers();
                users = users.filter(u => u.username !== username);
                saveUsers(users);
                displayUserList();
                alert('‚úÖ User removed successfully!');
            }
        }

        // Check admin access when switching to admin tab
        function checkAdminAccess() {
            if (isLoggedIn()) {
                showAdminContent();
                displayUserList();
            } else {
                document.getElementById('adminLocked').style.display = 'block';
                document.getElementById('adminContent').style.display = 'none';
            }
        }

        // Initialize users on page load
        initializeUsers();

        // ============================================
        // IMPORTANT: CONFIGURE YOUR GOOGLE SCRIPT URL HERE
        // ============================================
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwjdSeypt_TLDup6eEtLFbJyc1yLmrPZAfRoRdlANHtFDkvxN9tfJlabEUahTKHL9CC/exec';
        // Replace 'YOUR_SCRIPT_URL_HERE' with your actual Google Apps Script Web App URL
        // Example: 'https://script.google.com/macros/s/AKfycbx.../exec'
        
        let allComplaints = [];

        // Initialize flat numbers
        function initializeFlatNumbers() {
            const flatSelect = document.getElementById('flatNumber');
            const filterFlat = document.getElementById('filterFlat');
            
            const floors = [1, 2, 3, 4, 5];
            const units = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
            
            floors.forEach(floor => {
                units.forEach(unit => {
                    const flatNumber = `${floor}${unit}`;
                    const option = document.createElement('option');
                    option.value = flatNumber;
                    option.textContent = `Flat ${flatNumber}`;
                    flatSelect.appendChild(option.cloneNode(true));
                    filterFlat.appendChild(option);
                });
            });
        }

        // Update block based on flat selection
        function updateBlock() {
            const flatNumber = document.getElementById('flatNumber').value;
            const blockSelect = document.getElementById('blockName');
            
            if (!flatNumber) {
                blockSelect.value = '';
                return;
            }
            
            const unit = flatNumber.slice(-1);
            
            if (['A', 'B', 'C', 'D', 'E', 'F'].includes(unit)) {
                blockSelect.value = 'Block A';
            } else {
                blockSelect.value = 'Block B';
            }
        }

        // Generate unique complaint ID
        function generateComplaintId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `CMP${timestamp}${random}`;
        }

        // Check if script URL is configured
        function isConfigured() {
            if (SCRIPT_URL === 'YOUR_SCRIPT_URL_HERE') {
                return false;
            }
            return true;
        }

        // Show message
        function showMessage(elementId, message, duration = 5000) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            
            if (duration > 0) {
                setTimeout(() => {
                    element.style.display = 'none';
                }, duration);
            }
        }

        // Load complaints from Google Sheets
        async function loadComplaints() {
            if (!isConfigured()) {
                showMessage('viewInfoMessage', '‚ö†Ô∏è Please configure the Google Script URL in the HTML file.', 0);
                return;
            }

            try {
                showMessage('viewInfoMessage', '‚è≥ Loading complaints from Google Sheets...', 0);
                
                const response = await fetch(SCRIPT_URL);
                const result = await response.json();
                
                if (result.success) {
                    allComplaints = result.complaints || [];
                    displayComplaints();
                    updateStats();
                    document.getElementById('viewInfoMessage').style.display = 'none';
                } else {
                    showMessage('viewInfoMessage', '‚ùå Error loading complaints: ' + result.message, 0);
                }
            } catch (error) {
                showMessage('viewInfoMessage', '‚ùå Error connecting to Google Sheets: ' + error.message, 0);
            }
        }

        // Handle form submission
        document.getElementById('complaintForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!isConfigured()) {
                showMessage('errorMessage', '‚ö†Ô∏è Please configure the Google Script URL in the HTML file.');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner"></span> Submitting...';

            const complaint = {
                action: 'submit',
                id: generateComplaintId(),
                blockName: document.getElementById('blockName').value,
                flatNumber: document.getElementById('flatNumber').value,
                residentName: document.getElementById('residentName').value,
                contactNumber: document.getElementById('contactNumber').value || 'Not Provided',
                category: document.getElementById('category').value,
                priority: document.getElementById('priority').value,
                description: document.getElementById('description').value,
                status: 'Pending',
                dateRegistered: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(complaint)
                });

                // Note: no-cors mode doesn't allow reading response, so we assume success
                document.getElementById('complaintIdDisplay').textContent = complaint.id;
                showMessage('successMessage', `‚úì Complaint registered successfully! Your complaint ID is ${complaint.id}`);
                
                this.reset();
                document.getElementById('blockName').value = '';
                
                // Reload complaints after a short delay
                setTimeout(() => loadComplaints(), 2000);
                
            } catch (error) {
                showMessage('errorMessage', '‚ùå Error submitting complaint: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Complaint';
            }
        });


        // Display complaints in view tab
        function displayComplaints() {
            const container = document.getElementById('complaintsContainer');
            let complaints = [...allComplaints];

            // Apply filters
            const statusFilter = document.getElementById('filterStatus').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            const blockFilter = document.getElementById('filterBlock').value;
            const flatFilter = document.getElementById('filterFlat').value;

            if (statusFilter) {
                complaints = complaints.filter(c => c.status === statusFilter);
            }
            if (categoryFilter) {
                complaints = complaints.filter(c => c.category === categoryFilter);
            }
            if (blockFilter) {
                complaints = complaints.filter(c => c.blockName === blockFilter);
            }
            if (flatFilter) {
                complaints = complaints.filter(c => c.flatNumber === flatFilter);
            }

            if (complaints.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3>No complaints found</h3>
                        <p>No complaints match your filter criteria</p>
                    </div>
                `;
                return;
            }

            // Sort by date (newest first)
            complaints.sort((a, b) => new Date(b.dateRegistered) - new Date(a.dateRegistered));

            container.innerHTML = complaints.map(complaint => `
                <div class="complaint-card">
                    <div class="complaint-header">
                        <span class="complaint-id">${complaint.id}</span>
                        <span class="status-badge status-${complaint.status.toLowerCase().replace(' ', '-')}">${complaint.status}</span>
                    </div>
                    <div class="complaint-info">
                        <div class="info-item">
                            <span class="info-label">Block</span>
                            <span class="info-value">${complaint.blockName || 'N/A'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Flat Number</span>
                            <span class="info-value">Flat ${complaint.flatNumber}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Resident Name</span>
                            <span class="info-value">${complaint.residentName}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Category</span>
                            <span class="info-value">${complaint.category}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Priority</span>
                            <span class="info-value">${complaint.priority}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Registered On</span>
                            <span class="info-value">${new Date(complaint.dateRegistered).toLocaleDateString('en-IN')}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Contact</span>
                            <span class="info-value">${complaint.contactNumber}</span>
                        </div>
                    </div>
                    <div class="complaint-description">
                        <strong>Description:</strong><br>
                        ${complaint.description}
                    </div>
                </div>
            `).join('');
        }

        // Display complaints in admin panel
        function displayAdminComplaints() {
            const container = document.getElementById('adminComplaintsContainer');
            const complaints = [...allComplaints];
            const users = getUsers();
            const userOptions = users.map(u => `<option value="${u.name}">${u.name}</option>`).join('');

            if (complaints.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3>No complaints registered yet</h3>
                        <p>Complaints will appear here once residents start registering them</p>
                    </div>
                `;
                return;
            }

            // Sort by date (newest first)
            complaints.sort((a, b) => new Date(b.dateRegistered) - new Date(a.dateRegistered));

            container.innerHTML = complaints.map(complaint => {
                const isResolved = complaint.status === 'Resolved';
                const hasResolutionData = complaint.issueResolvedDate || complaint.resolvedBy || complaint.supervisor;
                
                return `
                <div class="complaint-card">
                    <div class="complaint-header">
                        <span class="complaint-id">${complaint.id}</span>
                        <span class="status-badge status-${complaint.status.toLowerCase().replace(' ', '-')}">${complaint.status}</span>
                    </div>
                    <div class="complaint-info">
                        <div class="info-item">
                            <span class="info-label">Block</span>
                            <span class="info-value">${complaint.blockName || 'N/A'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Flat Number</span>
                            <span class="info-value">Flat ${complaint.flatNumber}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Resident Name</span>
                            <span class="info-value">${complaint.residentName}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Category</span>
                            <span class="info-value">${complaint.category}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Priority</span>
                            <span class="info-value">${complaint.priority}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Registered On</span>
                            <span class="info-value">${new Date(complaint.dateRegistered).toLocaleDateString('en-IN')}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Contact</span>
                            <span class="info-value">${complaint.contactNumber}</span>
                        </div>
                    </div>
                    <div class="complaint-description">
                        <strong>Description:</strong><br>
                        ${complaint.description}
                    </div>
                    
                    ${hasResolutionData ? `
                        <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #0066cc;">
                            <strong style="color: #003d82;">üìã Resolution Details:</strong>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                                ${complaint.issueResolvedDate ? `
                                    <div>
                                        <span style="font-size: 0.85em; color: #6c757d;">Resolved Date:</span><br>
                                        <strong>${new Date(complaint.issueResolvedDate).toLocaleDateString('en-IN')}</strong>
                                    </div>
                                ` : ''}
                                ${complaint.resolvedBy ? `
                                    <div>
                                        <span style="font-size: 0.85em; color: #6c757d;">Resolved By:</span><br>
                                        <strong>${complaint.resolvedBy}</strong>
                                    </div>
                                ` : ''}
                                ${complaint.supervisor ? `
                                    <div>
                                        <span style="font-size: 0.85em; color: #6c757d;">Supervisor:</span><br>
                                        <strong>${complaint.supervisor}</strong>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}

                    <div class="action-buttons">
                        ${!isResolved ? `
                            <button class="btn-small" onclick="updateStatus('${complaint.id}', 'In Progress')">Mark In Progress</button>
                            <button class="btn-small" onclick="showResolutionForm('${complaint.id}')">‚úÖ Mark as Resolved</button>
                        ` : `
                            <button class="btn-small" onclick="updateStatus('${complaint.id}', 'In Progress')">Reopen</button>
                            <button class="btn-small" onclick="showResolutionForm('${complaint.id}')">Edit Resolution</button>
                        `}
                        <button class="btn-small" onclick="deleteComplaint('${complaint.id}')">Delete</button>
                    </div>

                    <!-- Resolution Form (Hidden by default) -->
                    <div id="resolutionForm_${complaint.id}" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 15px;">
                        <h4 style="margin-bottom: 15px; color: #667eea;">Resolution Details</h4>
                        <form onsubmit="submitResolution(event, '${complaint.id}')">
                            <div class="form-group">
                                <label for="resolvedDate_${complaint.id}">Issue Resolved Date *</label>
                                <input type="date" id="resolvedDate_${complaint.id}" value="${complaint.issueResolvedDate || ''}" required>
                            </div>
                            <div class="form-group">
                                <label for="resolvedBy_${complaint.id}">Resolved By *</label>
                                <input type="text" id="resolvedBy_${complaint.id}" placeholder="Enter person/team name" value="${complaint.resolvedBy || ''}" required>
                            </div>
                            <div class="form-group">
                                <label for="supervisor_${complaint.id}">Supervisor *</label>
                                <select id="supervisor_${complaint.id}" required>
                                    <option value="">Select Supervisor</option>
                                    ${users.map(u => `<option value="${u.name}" ${complaint.supervisor === u.name ? 'selected' : ''}>${u.name}</option>`).join('')}
                                </select>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button type="submit" class="btn" style="flex: 1;">üíæ Save Resolution</button>
                                <button type="button" class="btn-small" onclick="hideResolutionForm('${complaint.id}')" style="background: #6c757d; color: white; border-color: #6c757d;">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            `}).join('');
        }

        // Show resolution form
        function showResolutionForm(complaintId) {
            const form = document.getElementById(`resolutionForm_${complaintId}`);
            form.style.display = 'block';
            form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Hide resolution form
        function hideResolutionForm(complaintId) {
            document.getElementById(`resolutionForm_${complaintId}`).style.display = 'none';
        }

        // Submit resolution
        async function submitResolution(event, complaintId) {
            event.preventDefault();
            
            if (!isConfigured()) {
                alert('Please configure the Google Script URL in the HTML file.');
                return;
            }

            const resolvedDate = document.getElementById(`resolvedDate_${complaintId}`).value;
            const resolvedBy = document.getElementById(`resolvedBy_${complaintId}`).value;
            const supervisor = document.getElementById(`supervisor_${complaintId}`).value;

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateResolution',
                        id: complaintId,
                        status: 'Resolved',
                        issueResolvedDate: resolvedDate,
                        resolvedBy: resolvedBy,
                        supervisor: supervisor
                    })
                });

                // Hide the form
                hideResolutionForm(complaintId);
                
                // Reload complaints after update
                setTimeout(() => loadComplaints(), 1000);
                
                alert('‚úÖ Complaint marked as resolved successfully!');
                
            } catch (error) {
                alert('Error updating resolution: ' + error.message);
            }
        }

        // Update complaint status
        async function updateStatus(complaintId, newStatus) {
            if (!isConfigured()) {
                alert('Please configure the Google Script URL in the HTML file.');
                return;
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateStatus',
                        id: complaintId,
                        status: newStatus
                    })
                });

                // Reload complaints after update
                setTimeout(() => loadComplaints(), 1000);
                
            } catch (error) {
                alert('Error updating status: ' + error.message);
            }
        }

        // Delete complaint
        async function deleteComplaint(complaintId) {
            if (!confirm('Are you sure you want to delete this complaint?')) {
                return;
            }

            if (!isConfigured()) {
                alert('Please configure the Google Script URL in the HTML file.');
                return;
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'delete',
                        id: complaintId
                    })
                });

                // Reload complaints after delete
                setTimeout(() => loadComplaints(), 1000);
                
            } catch (error) {
                alert('Error deleting complaint: ' + error.message);
            }
        }

        // Update statistics
        function updateStats() {
            const complaints = allComplaints;
            
            document.getElementById('totalComplaints').textContent = complaints.length;
            document.getElementById('pendingComplaints').textContent = complaints.filter(c => c.status === 'Pending').length;
            document.getElementById('inProgressComplaints').textContent = complaints.filter(c => c.status === 'In Progress').length;
            document.getElementById('resolvedComplaints').textContent = complaints.filter(c => c.status === 'Resolved').length;
            
            displayAdminComplaints();
        }

        // Filter complaints
        function filterComplaints() {
            displayComplaints();
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            initializeFlatNumbers();
            
            // Check if configured
            if (!isConfigured()) {
                showMessage('viewInfoMessage', '‚ö†Ô∏è System not configured yet. Please configure the Google Script URL in the HTML file.', 0);
            }
        });
    </script>
</body>
</html>
